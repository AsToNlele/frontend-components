!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("@patternfly/react-core"),require("prop-types"),require("lodash/isEmpty"),require("react-intl"),require("@data-driven-forms/react-form-renderer/dist/cjs/form-renderer"),require("@data-driven-forms/react-form-renderer/dist/cjs/component-types"),require("@data-driven-forms/react-form-renderer/dist/cjs/validator-types"),require("@data-driven-forms/react-form-renderer/dist/cjs/validator-mapper"),require("@data-driven-forms/pf4-component-mapper/dist/cjs/form-template"),require("@data-driven-forms/pf4-component-mapper/dist/cjs/component-mapper"),require("lodash/get"),require("@patternfly/react-icons"),require("@data-driven-forms/react-form-renderer/dist/cjs/use-form-api"),require("@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors"),require("@data-driven-forms/react-form-renderer/dist/cjs/use-field-api"),require("@data-driven-forms/pf4-component-mapper/dist/cjs/select"),require("awesome-debounce-promise"),require("@data-driven-forms/react-form-renderer/dist/cjs/form-spy"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","@patternfly/react-core","prop-types","lodash/isEmpty","react-intl","@data-driven-forms/react-form-renderer/dist/cjs/form-renderer","@data-driven-forms/react-form-renderer/dist/cjs/component-types","@data-driven-forms/react-form-renderer/dist/cjs/validator-types","@data-driven-forms/react-form-renderer/dist/cjs/validator-mapper","@data-driven-forms/pf4-component-mapper/dist/cjs/form-template","@data-driven-forms/pf4-component-mapper/dist/cjs/component-mapper","lodash/get","@patternfly/react-icons","@data-driven-forms/react-form-renderer/dist/cjs/use-form-api","@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors","@data-driven-forms/react-form-renderer/dist/cjs/use-field-api","@data-driven-forms/pf4-component-mapper/dist/cjs/select","awesome-debounce-promise","@data-driven-forms/react-form-renderer/dist/cjs/form-spy","react-router-dom"],t):t((e=e||self)["@redhat-cloud-services/frontend-components-sources-index"]={},e.React,e["@patternfly/react-core"],e["prop-types"],e.isEmpty,e["react-intl"],e.FormRenderer,e.componentTypes,e.validatorTypes,e.validatorMapper,e.FormTemplate,e.componentMapper,e.get,e["@patternfly/react-icons"],e.useFormApi,e.axiosInstanceInsights,e.useFieldApi,e.Select,e.awesomeDebouncePromise,e.FormSpy,e["react-router-dom"])}(this,(function(e,t,n,a,r,o,i,s,c,l,u,d,p,m,f,g,h,y,E,v,b){"use strict";var M="default"in t?t.default:t;function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}a=a&&a.hasOwnProperty("default")?a.default:a,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,s=s&&s.hasOwnProperty("default")?s.default:s,c=c&&c.hasOwnProperty("default")?c.default:c,l=l&&l.hasOwnProperty("default")?l.default:l,u=u&&u.hasOwnProperty("default")?u.default:u,d=d&&d.hasOwnProperty("default")?d.default:d,p=p&&p.hasOwnProperty("default")?p.default:p,f=f&&f.hasOwnProperty("default")?f.default:f,g=g&&g.hasOwnProperty("default")?g.default:g,h=h&&h.hasOwnProperty("default")?h.default:h,y=y&&y.hasOwnProperty("default")?y.default:y,E=E&&E.hasOwnProperty("default")?E.default:E,v=v&&v.hasOwnProperty("default")?v.default:v;var T=createCommonjsModule((function(e){function _extends(){return e.exports=_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_extends.apply(this,arguments)}e.exports=_extends}));var w=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r};var S=function _objectWithoutProperties(e,t){if(null==e)return{};var n,a,r=w(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r};var x=function _arrayWithHoles(e){if(Array.isArray(e))return e};var _=function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}};var A=function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a};var I=function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}};var C=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var O=function _slicedToArray(e,t){return x(e)||_(e,t)||I(e,t)||C()};var F=function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var R=function _arrayWithoutHoles(e){if(Array.isArray(e))return A(e)};var L=function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var k=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var D=function _toConsumableArray(e){return R(e)||L(e)||I(e)||k()},z=function SSLFormLabel(){var e=o.useIntl();return(M.createElement(M.Fragment,null,e.formatMessage({id:"wizard.sslCertificate",defaultMessage:"SSL Certificate"}),M.createElement(n.Popover,{"aria-label":"Help text",maxWidth:"50%",bodyContent:M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.openshiftCADescription1",defaultMessage:"You can obtain your OpenShift Container Platform provider’s CA certificate for all endpoints (default, metrics, alerts) from {cmd}."},{cmd:M.createElement("b",{key:"b"},"/etc/origin/master/ca.crt")})),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.openshiftCADescription2",defaultMessage:"Paste the output (a block of text starting with --BEGIN CERTIFICATE--) into the Trusted CA Certificates field."})))},M.createElement(m.QuestionCircleIcon,{className:"pf-u-ml-sm"}))))},P=M.createElement(o.FormattedMessage,{id:"wizard.wizardDescription",defaultMessage:"Connect a data source to use with your applications."}),j=M.createElement(o.FormattedMessage,{id:"wizard.wizardTitle",defaultMessage:"Add source"}),V="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.5",N="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#creating_an_aws_s3_bucket"),q="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#enabling_aws_account_access"),B="/api/cost-management/v1",W=g,U=function getSourcesApi(){return{createEndpoint:function createEndpoint(e){return g.post("".concat("/api/sources/v1.0","/endpoints"),e)},createAuthentication:function createAuthentication(e){return g.post("".concat("/api/sources/v1.0","/authentications"),e)},deleteSource:function deleteSource(e){return g.delete("".concat("/api/sources/v1.0","/sources/").concat(e))},createApplication:function createApplication(e){return g.post("".concat("/api/sources/v1.0","/applications"),e)},postGraphQL:function postGraphQL(e){return g.post("".concat("/api/sources/v1.0","/graphql"),e)},listSourceTypes:function listSourceTypes(){return g.get("".concat("/api/sources/v1.0","/source_types"))},listApplicationTypes:function listApplicationTypes(){return g.get("".concat("/api/sources/v1.0","/application_types"))},createSource:function createSource(e){return g.post("".concat("/api/sources/v1.0","/sources"),e)},createAuthApp:function createAuthApp(e){return g.post("".concat("/api/sources/v2.0","/application_authentications"),e)},getApplication:function getApplication(e){return g.get("".concat("/api/sources/v2.0","/applications/").concat(e))},removeSource:function removeSource(e){return g.delete("".concat("/api/sources/v2.0","/sources/").concat(e))}}},G=function findSource(e){return U().postGraphQL({query:'{ sources(filter: {name: "'.concat(e,'"})\n        { id, name }\n    }')})},$="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#installing_ocp_prerequisites"),K="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#creating_an_azure_storage_account"),H="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#configuring_an_azure_service_principal"),X="".concat(V,"/html/getting_started_with_cost_management/assembly_adding_sources_cost#configuring_an_azure_daily_export_schedule"),Q=function AllFieldAreRequired(){var e=o.useIntl();return(M.createElement(n.Text,{component:n.TextVariants.p,className:"ins-c-sources__wizard--all-required-text"},e.formatMessage({id:"catalog.auth.allFieldsRequired",defaultMessage:"All fields are required."})))},Y=M.createElement(o.FormattedMessage,{id:"wizard.arnPattern",defaultMessage:"ARN must start with arn:aws:"}),Z=M.createElement(o.FormattedMessage,{id:"wizard.arnLength",defaultMessage:"ARN should have at least 10 characters"}),J={placeholder:"arn:aws:iam:123456789:role/CostManagement",isRequired:!0,validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^arn:aws:.*/,message:Y},{type:c.MIN_LENGTH,threshold:10,message:Z}]},ee={placeholder:"arn:aws:iam:123456789:role/SubscriptionWatch",isRequired:!0,validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^arn:aws:.*/,message:Y},{type:c.MIN_LENGTH,threshold:10,message:Z}],label:M.createElement(o.FormattedMessage,{id:"wizard.arn",defaultMessage:"ARN"})},te={isRequired:!0,validate:[{type:c.REQUIRED},{type:c.PATTERN,message:M.createElement(o.FormattedMessage,{id:"catalog.urlPatternMessage",defaultMessage:"URL must start with https:// or http://"}),pattern:/^https{0,1}:\/\//},{type:c.URL}],helperText:M.createElement(n.FormHelperText,{isHidden:!1},M.createElement(o.FormattedMessage,{id:"catalog.hostnameHelper",defaultMessage:"For example, https://myansibleinstance.example.com/ or https://127.0.0.1/"})),label:M.createElement(o.FormattedMessage,{id:"wizard.hostname",defaultMessage:"Hostname"})},ne={openshift:{authentication:{token:F({generic:{"authentication.password":{isRequired:!0,validate:[{type:c.REQUIRED}]},additionalFields:[{component:"description",name:"description-summary",Content:function DescriptionSummary(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"openshift.token.description",defaultMessage:"An OpenShift Container Platform login token is required to communicate with the application."})),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"openshift.token.collectData",defaultMessage:"To collect data from a Red Hat OpenShift Container Platform source:"})),M.createElement(n.TextList,{component:"ol"},M.createElement(n.TextListItem,{component:"li"},e.formatMessage({id:"openshift.token.logIn",defaultMessage:"Log in to the Red Hat OpenShift Container Platform cluster with an account that has access to the namespace"})),M.createElement(n.TextListItem,{component:"li"},e.formatMessage({id:"openshift.token.runCommand",defaultMessage:"Run the following command to obtain your login token:"})),M.createElement(n.ClipboardCopy,{className:"pf-u-mb-md",isReadOnly:!0},e.formatMessage({id:"openshift.token.comman",defaultMessage:"# oc sa get-token -n management-infra management-admin"})),M.createElement(n.TextListItem,{component:"li"},e.formatMessage({id:"openshift.token.copyToken",defaultMessage:"Copy the token and paste it in the Token field"})))))}}]}},"/insights/platform/cost-management",{skipSelection:!0,skipEndpoint:!0,"source.source_ref":{label:M.createElement(o.FormattedMessage,{id:"wizard.clusterId",defaultMessage:"Cluster Identifier"}),isRequired:!0,component:s.TEXT_FIELD,validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^[A-Za-z0-9]+[A-Za-z0-9_-]*$/,message:M.createElement(o.FormattedMessage,{id:"wizard.clusterIdPattern",defaultMessage:"Cluster ID must start with alphanumeric character and can contain underscore and hyphen"})}]},additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"cost.configureOperator",defaultMessage:"Cost Management Operator"}),fields:[{component:"description",name:"description-summary",Content:function ConfigureCostOperator(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.openshift.description",defaultMessage:"The Cost Management Operator collects the data required for Cost Management. This is supported for clusters that are OpenShift Container Platform version 4.3 or later. {more}"},{more:M.createElement(n.Text,{key:"link",component:n.TextVariants.a,href:$,target:"_blank",rel:"noopener noreferrer"},e.formatMessage({id:"wizard.learnMore",defaultMessage:"Learn more"}))})),M.createElement(n.TextContent,{className:"list-align-left"},M.createElement(n.TextList,{component:"ol"},M.createElement(n.TextListItem,{component:"li"},e.formatMessage({id:"cost.openshift.installOperator",defaultMessage:"Install the Cost Management Operator from OperatorHub on your cluster (search for {cost})."},{cost:M.createElement("i",{key:"italic"},e.formatMessage({id:"cost.costManagement",defaultMessage:"cost management"}))})),M.createElement(n.TextListItem,{component:"li"},e.formatMessage({id:"cost.openshift.aboutScreen",defaultMessage:"When configuration is complete, enter the cluster identifier below. The cluster identifier can be found in the cluster's Help > About screen."}))))))}},{name:"source.source_ref"},{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"token",initializeOnMount:!0}]}]})},endpoint:{url:{placeholder:"https://myopenshiftcluster.mycompany.com",isRequired:!0,validate:[{type:c.REQUIRED},{type:c.URL,message:M.createElement(o.FormattedMessage,{id:"wizard.urlPatternMessage",defaultMessage:"The URL is not formatted correctly."})}]},"endpoint.certificate_authority":{label:M.createElement(z,null),"aria-label":"SSL Certificate"},additionalFields:[{component:"description",name:"description-summary",Content:function EndpointDesc(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"openshift.endpoint.urlAndCA",defaultMessage:"Provide the OpenShift Container Platform URL and SSL certificate."}))))}}]}},azure:{authentication:{tenant_id_client_id_client_secret:F({},"/insights/platform/cost-management",{useApplicationAuth:!0,skipSelection:!0,"credentials.subscription_id":{placeholder:"",validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^[A-Za-z0-9]+[A-Za-z0-9_-]*$/,message:M.createElement(o.FormattedMessage,{id:"cost.subidPattern",defaultMessage:"Subscription ID must start with alphanumeric character and can contain underscore and hyphen"})}],isRequired:!0},"billing_source.data_source.resource_group":{placeholder:"",validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^[A-Za-z0-9]+[A-Za-z0-9_-]*$/,message:M.createElement(o.FormattedMessage,{id:"cost.resourceGroupPattern",defaultMessage:"Resource group must start with alphanumeric character and can contain underscore and hyphen"})}]},"billing_source.data_source.storage_account":{placeholder:"",validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^[A-Za-z0-9]+[A-Za-z0-9_-]*$/,message:M.createElement(o.FormattedMessage,{id:"cost.storageAccountPattern",defaultMessage:"Storage account must start with alphanumeric character and can contain underscore and hyphen"})}]},"authentication.password":{type:"password",validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"cost.clientSecret",defaultMessage:"Client secret"})},"authentication.username":{validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"cost.clientAppId",defaultMessage:"Client (Application) ID"})},"authentication.extra.azure.tenant_id":{label:M.createElement(o.FormattedMessage,{id:"cost.tenantDirId",defaultMessage:"Tenant (Directory) ID"}),validate:[{type:c.REQUIRED}]},additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"cost.azureSubStepId",defaultMessage:"Resource group and storage account"}),nextStep:"azure-sub-id",fields:[{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"tenant_id_client_id_client_secret",initializeOnMount:!0},{name:"azure-storage-account-description",component:"description",Content:function ConfigureResourceGroupAndStorageAccount(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.storageAccountDescription",defaultMessage:"Red Hat recommends creating a dedicated resource group and storage account in Azure to collect cost data and metrics for cost management. {link}"},{link:M.createElement(n.Text,{key:"link",rel:"noopener noreferrer",target:"_blank",component:n.TextVariants.a,href:K},e.formatMessage({id:"wizard.learnMore defaultMessage=Learn more",defaultMessage:"Learn more"}))})),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.storageAccountAfterDescription",defaultMessage:"After configuring a resource group and storage account in the Azure portal, enter the following:"}))))}},{name:"all-required",component:"description",Content:Q},{name:"billing_source.data_source.resource_group",component:s.TEXT_FIELD,label:M.createElement(o.FormattedMessage,{id:"wizard.resourceGroupName",defaultMessage:"Resource group name"})},{name:"billing_source.data_source.storage_account",component:s.TEXT_FIELD,label:M.createElement(o.FormattedMessage,{id:"wizard.storageAccountName",defaultMessage:"Storage account name"})}]},{title:M.createElement(o.FormattedMessage,{id:"wizard.subscriptionId",defaultMessage:"Subscription ID"}),name:"azure-sub-id",nextStep:"configure-roles",fields:[{name:"azure-sub-id-description",component:"description",Content:function SubscriptionID(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.subscriptionIdCommand",defaultMessage:"Run the following command in Cloud Shell to obtain your Subscription ID and enter it below:"})),M.createElement(n.ClipboardCopy,null,'az account show --query "{ subscription_id: id }"')))}},{name:"credentials.subscription_id",component:s.TEXT_FIELD,label:M.createElement(o.FormattedMessage,{id:"wizard.subscriptionId",defaultMessage:"Subscription ID"})}]},{title:M.createElement(o.FormattedMessage,{id:"wizard.configureRoles",defaultMessage:"Roles"}),name:"configure-roles",nextStep:"export-schedule",fields:[{name:"configure-service-principal",component:"description",Content:function ConfigureRolesDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.dedicatedCredentials",defaultMessage:"Red Hat recommends configuring dedicated credentials to grant Cost Management read-only access to Azure cost data.  {link}"},{link:M.createElement(n.Text,{key:"link",rel:"noopener noreferrer",target:"_blank",component:n.TextVariants.a,href:H},e.formatMessage({id:"wizard.learnMore defaultMessage=Learn more",defaultMessage:"Learn more"}))})),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.createContributorRole",defaultMessage:"Run the following command in Cloud Shell to create a Cost Management Storage Account Contributor role. From the output enter the values in the fields below:"})),M.createElement(n.ClipboardCopy,null,'az ad sp create-for-rbac -n "CostManagement" --role "Storage Account Contributor" --query \'{"tenant": tenant, "client_id": appId, "secret": password}\'')))}},{name:"all-required",component:"description",Content:Q},{name:"authentication.extra.azure.tenant_id",component:s.TEXT_FIELD},{name:"authentication.username",component:s.TEXT_FIELD},{name:"authentication.password",component:s.TEXT_FIELD},{name:"reader-role",component:"description",Content:function ReaderRoleDescription(){var e=f().getState().values.credentials,t=o.useIntl();return M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},t.formatMessage({id:"cost.azure.createReaderRole",defaultMessage:"Run the following command in Cloud Shell to create a Cost Management Reader role:"})),M.createElement(n.ClipboardCopy,null,'az role assignment create --role "Cost Management Reader" --assignee http://CostManagement --subscription '.concat(e.subscription_id)))}}]},{title:M.createElement(o.FormattedMessage,{id:"cost.createDailyExport",defaultMessage:"Daily export"}),name:"export-schedule",fields:[{name:"export-schedule-description",component:"description",Content:function ExportSchedule(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.azure.storageAccountDescription",defaultMessage:"Create a recurring task to export cost data to your Azure storage account, where cost management will retrieve the data.  {link}"},{link:M.createElement(n.Text,{key:"link",rel:"noopener noreferrer",target:"_blank",component:n.TextVariants.a,href:X},e.formatMessage({id:"wizard.learnMore defaultMessage=Learn more",defaultMessage:"Learn more"}))})),M.createElement(n.TextContent,{className:"list-align-left"},M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,{component:n.TextListItemVariants.li},e.formatMessage({id:"cost.azure.storageAccountDescription",defaultMessage:"From the Azure portal, add a new export."})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.li},e.formatMessage({id:"cost.azure.storageAccountDescription",defaultMessage:"Provide a name for the container and directory path, and specify the below settings to create the daily export. Leave all other options as the default."})))),M.createElement(n.TextList,{className:"export-table",component:n.TextListVariants.dl},M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},M.createElement(n.Text,{component:n.TextVariants.b},e.formatMessage({id:"cost.azure.exportType",defaultMessage:"Export type"}))),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},e.formatMessage({id:"cost.azure.dailyExport",defaultMessage:"Daily export for billing-period-to-date costs"})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},M.createElement(n.Text,{component:n.TextVariants.b},e.formatMessage({id:"cost.azure.storageAccountName",defaultMessage:"Storage account name"}))),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},e.formatMessage({id:"cost.azure.createdAccountName",defaultMessage:"Storage account name created earlier"})))))}}]}]})}},amazon:{authentication:{access_key_secret_key:{generic:{"authentication.username":{label:M.createElement(o.FormattedMessage,{id:"wizard.accessKeyId",defaultMessage:"Access key ID"}),placeholder:"AKIAIOSFODNN7EXAMPLE",isRequired:!0,validate:[{type:c.REQUIRED}]},"authentication.password":{label:M.createElement(o.FormattedMessage,{id:"wizard.secretAccessKey",defaultMessage:"Secret access key"}),placeholder:"wJairXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",isRequired:!0,validate:[{type:c.REQUIRED}],type:"password"},skipSelection:!0,onlyHiddenFields:!0,additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"wizard.configureAccountAccess",defaultMessage:"Account access"}),fields:[{component:"description",name:"description-summary",Content:function DescriptionSummary(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.createAccesKeyPart1",defaultMessage:"Create an access key in your AWS user account and enter the details below."})),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.createAccesKeyPart2",defaultMessage:"For sufficient access and security, Red Hat recommends using the Power user identity and access management (IAM) policy for your AWS user account. "}),M.createElement(n.Popover,{"aria-label":"Help text",position:"bottom",bodyContent:M.createElement(M.Fragment,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.createAccesKeyHelpText",defaultMessage:"The Power user policy allows the user full access to API functionality and AWS services for user administration. Create an access key in the Security Credentials area of your AWS user account. When adding your AWS account as a source, the access key ID and secret access key act as your user ID and password."})))},M.createElement(m.QuestionCircleIcon,null)))))}},{name:"authentication.username",component:s.TEXT_FIELD},{name:"authentication.password",component:s.TEXT_FIELD},{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"access_key_secret_key",initializeOnMount:!0}]}]}},arn:F({generic:{includeStepKeyFields:["arn"],"authentication.password":J}},"/insights/platform/cost-management",{useApplicationAuth:!0,skipSelection:!0,"authentication.password":J,"billing_source.data_source.bucket":{placeholder:"cost-usage-bucket",validate:[{type:c.REQUIRED},{type:c.PATTERN,pattern:/^[A-Za-z0-9]+[A-Za-z0-9_-]*$/,message:M.createElement(o.FormattedMessage,{id:"cost.arn.s3BucketPattern",defaultMessage:"S3 bucket name must start with alphanumeric character and can contain underscore and hyphen"})}],isRequired:!0},additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"cost.arn.usageDescriptionTitle",defaultMessage:"Cost and usage reporting"}),nextStep:"tags",fields:[{name:"usage-description",component:"description",Content:function UsageDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.usageDescription.usageDescription",defaultMessage:"To collect and store the information needed for cost management, you need to set up an Amazon S3 bucket for cost and usage reports. {link}"},{link:M.createElement(n.Text,{key:"link",component:n.TextVariants.a,href:N,rel:"noopener noreferrer",target:"_blank"},e.formatMessage({id:"cost.learnMore",defaultMessage:"Learn more"}))})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.specifyBucker",defaultMessage:"Specify or create an Amazon S3 bucket for your account."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.addFollowingValues",defaultMessage:"Create a cost and usage report using the following values:"}),M.createElement(n.TextList,null,M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.repornName",defaultMessage:"Report name: koku"})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.timeUnitHoulry",defaultMessage:"Time unit: hourly"})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.includesResourceIDs",defaultMessage:"Include: Resource IDs"})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.enableSuppor",defaultMessage:"Enable support for: RedShift, QuickSight and disable support for Athena"})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.reportPathPrefix",defaultMessage:"Report path prefix: (leave blank)"})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.compression",defaultMessage:"Compression type: GZIP"})))),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.usageDescription.enterNameOfCreatedBucker",defaultMessage:"Enter the name of the Amazon S3 bucket you just created below:"})))))}},{name:"billing_source.data_source.bucket",component:s.TEXT_FIELD,label:M.createElement(o.FormattedMessage,{id:"cost.arn.s3Label",defaultMessage:"S3 bucket name"})},{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"arn",initializeOnMount:!0}]},{title:M.createElement(o.FormattedMessage,{id:"cost.arn.tagsStepTitle",defaultMessage:"Activate cost allocation tags"}),name:"tags",nextStep:"iam-policy",fields:[{name:"tags-description",component:"description",Content:function TagsDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.tags.desciption",defaultMessage:"To use tags to organize your AWS resources in the cost management application, activate your tags in AWS to allow them to be imported automatically."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.tags.openSection",defaultMessage:"In the AWS Billing and Cost Management console, open the Cost Allocation Tags section."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.tags.selectTags",defaultMessage:"Select the tags you want to use in the cost management application, and click Activate."})))))}}]},{title:M.createElement(o.FormattedMessage,{id:"cost.arn.iamPolicyTitle",defaultMessage:"Create IAM policy"}),name:"iam-policy",nextStep:"iam-role",substepOf:{name:"eaa",title:M.createElement(o.FormattedMessage,{id:"cost.arn.enableAccountAccess",defaultMessage:"Enable account access"})},fields:[{name:"iam-policy-description",component:"description",Content:function IAMPolicyDescription(){var e,t,a=f(),r=o.useIntl(),i=null===(e=a.getState().values.billing_source)||void 0===e?void 0:null===(t=e.data_source)||void 0===t?void 0:t.bucket;return i?M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},r.formatMessage({id:"cost.iampolicy.grantPermissions",defaultMessage:"To grant permissions to the cost management report you just configured, create an AWS Identity and Access Management (IAM) policy. {link}"},{link:M.createElement(n.Text,{key:"link",component:n.TextVariants.a,href:q,rel:"noopener noreferrer",target:"_blank"},r.formatMessage({id:"wizard.learnMore",defaultMessage:"Learn more"}))})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,{component:n.TextListItemVariants.li},r.formatMessage({id:"cost.iampolicy.signInIAMConsole",defaultMessage:"Sign in to the AWS Identity and Access Management (IAM) console."})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.li},r.formatMessage({id:"cost.iampolicy.createPolicy",defaultMessage:"Create a new policy, pasting the following content into the JSON text box."})),M.createElement(n.ClipboardCopy,{isCode:!0,variant:n.ClipboardCopyVariant.expansion,className:"pf-u-m-sm-on-sm",isReadOnly:!0},JSON.stringify({Version:"2012-10-17",Statement:[{Sid:"VisualEditor0",Effect:"Allow",Action:["s3:Get*","s3:List*"],Resource:["arn:aws:s3:::".concat(i),"arn:aws:s3:::".concat(i,"/*")]},{Sid:"VisualEditor1",Effect:"Allow",Action:["s3:HeadBucket","cur:DescribeReportDefinitions"],Resource:"*"}]},null,2)),M.createElement(n.TextListItem,{component:n.TextListItemVariants.li},r.formatMessage({id:"cost.iampolicy.completeProccess",defaultMessage:"Complete the process to create your new policy."}))),M.createElement(n.Text,{component:n.TextVariants.p},r.formatMessage({id:"cost.iampolicy.logInIam",defaultMessage:"{bold} You will need to be logged in to the IAM console to complete the next step."},{bold:M.createElement("b",{key:"bold"},r.formatMessage({id:"cost.DoNotCloseYourBrowser",defaultMessage:"Do not close your browser."}))}))):M.createElement(n.Text,{component:n.TextVariants.p},r.formatMessage({id:"cost.iampolicy.somethingWrong",defaultMessage:"Something went wrong, you are missing bucket value."}))}}]},{title:M.createElement(o.FormattedMessage,{id:"cost.arn.iamRoleStepTitle",defaultMessage:"Create IAM role"}),name:"iam-role",nextStep:"arn",substepOf:"eaa",fields:[{name:"iam-role-description",component:"description",Content:function IAMRoleDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.iamrole.createIamRole",defaultMessage:"To delegate account access, create an IAM role to associate with your IAM policy."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.iamrole.createNewRole",defaultMessage:"From the AWS Identity access management console, create a new role."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.iamrole.enterAccountId",defaultMessage:"Select another AWS account from the list of trusted entities and paste the following value into the Account ID field:"})),M.createElement(n.ClipboardCopy,{className:"pf-u-m-sm-on-sm",isReadOnly:!0},"589173575009"),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.iamrole.attachPolicy",defaultMessage:"Attach the permissions policy that you just created."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.iamrole.completeProccess",defaultMessage:"Complete the process to create your new role."})))))}}]},{title:M.createElement(o.FormattedMessage,{id:"cost.arn.enterArn",defaultMessage:"Enter ARN"}),name:"arn",substepOf:"eaa",fields:[{name:"arn-description",component:"description",Content:function ArnDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"cost.arn.enableAccess",defaultMessage:"To enable account access, capture the ARN associated with the role you just created."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.arn.selectRole",defaultMessage:"From the Roles tab, select the role you just created."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"cost.arn.copyArn",defaultMessage:"From the Summary screen, copy the role ARN and paste it in the ARN field:"})))))}}]}]}),"cloud-meter-arn":F({generic:{includeStepKeyFields:["arn"],"authentication.password":ee}},"/insights/platform/cloud-meter",{useApplicationAuth:!0,skipSelection:!0,"authentication.password":ee,additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"cloudmeter.createIamPolicy",defaultMessage:"Create IAM policy"}),nextStep:"subs-iam-role",substepOf:{name:"eaa",title:M.createElement(o.FormattedMessage,{id:"cloudmeter.enableAccountAccess",defaultMessage:"Enable account access"})},fields:[{name:"iam-policy-description",component:"description",Content:function IAMPolicyDescription(){var e=o.useIntl(),a=t.useState(),r=O(a,2),i=r[0],s=r[1];return t.useEffect((function(){(function getSubWatchConfig(){return W.get("/api/cloudigrade/v2/sysconfig/")})().then((function(e){var t;return s(null==e?void 0:null===(t=e.aws_policies)||void 0===t?void 0:t.traditional_inspection)})).catch((function(t){console.error(t),s(e.formatMessage({id:"subwatch.iampolicy.subWatchConfigError",defaultMessage:"There is an error with loading of the configuration. Please go back and return to this step."}))}))}),[]),M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"subwatch.iampolicy.grantPermissions",defaultMessage:"To grant permissions to obtain subscription data, create an AWS identity access management (IAM) policy."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iampolicy.signIn",defaultMessage:"Sign in to the {link}."},{link:M.createElement("a",{key:"link",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/console.html",rel:"noopener noreferrer",target:"_blank"},e.formatMessage({id:"subwatch.iampolicy.IAMconsole",defaultMessage:"AWS Identity Access Management* (IAM) console"}))})),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iampolicy.createPolicty",defaultMessage:"Create a new policy, pasting the following content into the JSON text box."})),M.createElement(n.ClipboardCopy,{isCode:!0,variant:n.ClipboardCopyVariant.expansion,className:"pf-u-m-sm-on-sm",isReadOnly:!0},i?JSON.stringify(i,null,2):e.formatMessage({id:"subwatch.iampolicy.loading",defaultMessage:"Loading configuration..."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iampolicy.completeProcess",defaultMessage:"Complete the process to create your new policy."}))),M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"subwatch.iampolicy.BDoNotCloseYourBrowserBYouWillNeedToBeLoggedInToTheIamConsoleToComputeTheNextStep",defaultMessage:"{bold} You will need to be logged in to the IAM console to compute the next step."},{bold:M.createElement("b",{key:"bold"},e.formatMessage({id:"subwatch.iampolicy.dontCloseBrowser",defaultMessage:"Do not close your browser."}))})))}},{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"cloud-meter-arn",initializeOnMount:!0}]},{title:M.createElement(o.FormattedMessage,{id:"cloudmeter.createIamRole",defaultMessage:"Create IAM role"}),name:"subs-iam-role",nextStep:"subs-arn",substepOf:"eaa",fields:[{name:"iam-role-description",component:"description",Content:function IAMRoleDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"subwatch.iamrole.delegateAccount",defaultMessage:"To delegate account access, create an IAM role to associate with your IAM policy."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iamrole.createRole",defaultMessage:"From the AWS Identity access management console, create a new role."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iamrole.pasteAccountID",defaultMessage:"Select another AWS account from the list of trusted entities and paste the following value into the Account ID field:"})),M.createElement(n.ClipboardCopy,{className:"pf-u-m-sm-on-sm",isReadOnly:!0},"372779871274"),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iamrole.attachPolicy",defaultMessage:"Attach the permissions policy that you just created."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.iamrole.completeProcess",defaultMessage:"Complete the process to create your new role."})))))}}]},{title:M.createElement(o.FormattedMessage,{id:"cloudmeter.enterArn",defaultMessage:"Enter ARN"}),name:"subs-arn",substepOf:"eaa",fields:[{name:"arn-description",component:"description",Content:function ArnDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"subwatch.arn.enableAccount",defaultMessage:"To enable account access, capture the ARN associated with the role you just created."})),M.createElement(n.TextList,{component:n.TextListVariants.ol},M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.arn.selectRole",defaultMessage:"From the Roles tab, select the role you just created."})),M.createElement(n.TextListItem,null,e.formatMessage({id:"subwatch.arn.copyArn",defaultMessage:"From the Summary screen, copy the role ARN and paste it in the ARN field:"})))))}},{component:s.TEXT_FIELD,name:"authentication.password"}]}]})},endpoint:{}},satellite:{endpoint:{},authentication:{receptor_node:{generic:{"source.source_ref":{label:M.createElement(o.FormattedMessage,{id:"satellite.satelliteId",defaultMessage:"Satellite ID"}),validate:[{type:c.REQUIRED}],component:s.TEXT_FIELD},"endpoint.receptor_node":{label:M.createElement(o.FormattedMessage,{id:"satellite.receptorId",defaultMessage:"Receptor ID"}),validate:[{type:c.REQUIRED}],component:s.TEXT_FIELD},skipSelection:!0,onlyHiddenFields:!0,customSteps:!0,additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"satellite.credentials",defaultMessage:"Credentials"}),nextStep:"summary",fields:[{name:"all-required",component:"description",Content:Q},{name:"source.source_ref"},{name:"endpoint.receptor_node"},{component:s.TEXT_FIELD,name:"endpoint.role",hideField:!0,initializeOnMount:!0,initialValue:"satellite"},{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initializeOnMount:!0,initialValue:"receptor_node"}]}]}}}},"ansible-tower":{authentication:{receptor_node:F({generic:{skipEndpoint:!0}},"/insights/platform/catalog",{skipEndpoint:!0}),username_password:F({generic:{skipSelection:!0,onlyHiddenFields:!0,customSteps:!0,"authentication.username":{isRequired:!1,validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"wizard.username",defaultMessage:"Username"})},"authentication.password":{type:"password",isRequired:!1,validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"wizard.password",defaultMessage:"Password"})},url:te,"endpoint.certificate_authority":{label:M.createElement(o.FormattedMessage,{id:"wizard.certificateAuthoriy",defaultMessage:"Certificate authority"})},"endpoint.verify_ssl":{initialValue:!1,label:M.createElement(o.FormattedMessage,{id:"wizard.verifySsl",defaultMessage:"Verify SSL"})},additionalSteps:[{title:M.createElement(o.FormattedMessage,{id:"wizard.credentials",defaultMessage:"Credentials"}),nextStep:"ansible-tower-credentials-no-app",fields:[{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"username_password",initializeOnMount:!0},{name:"required-desc",component:"description",Content:Q},{component:s.TEXT_FIELD,name:"authentication.username"},{component:s.TEXT_FIELD,name:"authentication.password"}]},{name:"ansible-tower-credentials-no-app",title:M.createElement(o.FormattedMessage,{id:"catalog.ansibleTowerEndpoint",defaultMessage:"Ansible Tower endpoint"}),fields:[{name:"endpoint.role",component:s.TEXT_FIELD,hideField:!0,initialValue:"ansible",initializeOnMount:!0},{name:"url",component:s.TEXT_FIELD},{name:"endpoint.verify_ssl",component:s.SWITCH},{name:"endpoint.certificate_authority",component:s.TEXT_FIELD,condition:{is:!0,when:"endpoint.verify_ssl"}}]}]}},"/insights/platform/catalog",{skipSelection:!0,onlyHiddenFields:!0,customSteps:!0,"authentication.username":{isRequired:!1,validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"wizard.username",defaultMessage:"Username"})},"authentication.password":{type:"password",isRequired:!1,validate:[{type:c.REQUIRED}],label:M.createElement(o.FormattedMessage,{id:"wizard.password",defaultMessage:"Password"})},url:te,"endpoint.certificate_authority":{label:M.createElement(o.FormattedMessage,{id:"wizard.certificateAuthoriy",defaultMessage:"Certificate authority"})},"endpoint.verify_ssl":{initialValue:!1,label:M.createElement(o.FormattedMessage,{id:"wizard.verifySsl",defaultMessage:"Verify SSL"})},additionalSteps:[{nextStep:"catalog-ansible-tower",title:M.createElement(o.FormattedMessage,{id:"catalog.ansibleTowerEndpoint",defaultMessage:"Ansible Tower endpoint"}),fields:[{name:"ansible-tower-desc",component:"description",Content:function EndpointDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p,className:"pf-u-mb-l"},e.formatMessage({id:"catalog.endpoint.enterHostname",defaultMessage:"Enter the hostname of the Ansible Tower instance you want to connect to."}))))}},{name:"endpoint.role",component:s.TEXT_FIELD,hideField:!0,initialValue:"ansible",initializeOnMount:!0},{name:"url",component:s.TEXT_FIELD},{name:"endpoint.verify_ssl",component:s.SWITCH},{name:"endpoint.certificate_authority",component:s.TEXT_FIELD,condition:{is:!0,when:"endpoint.verify_ssl"}}]},{title:M.createElement(o.FormattedMessage,{id:"wizard.credentials",defaultMessage:"Credentials"}),name:"catalog-ansible-tower",fields:[{component:s.TEXT_FIELD,name:"authentication.authtype",hideField:!0,initialValue:"username_password",initializeOnMount:!0},{name:"required-desc",component:"description",Content:function AuthDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p,className:"pf-u-mb-l"},e.formatMessage({id:"catalog.auth.provideTowerCredentials",defaultMessage:"Provide Ansible Tower service account user credentials to ensure optimized availability of resources to Catalog Administrators."})),M.createElement(Q,null)))}},{component:s.TEXT_FIELD,name:"authentication.username"},{component:s.TEXT_FIELD,name:"authentication.password"}]}]})},endpoint:{url:te,"endpoint.certificate_authority":{label:M.createElement(o.FormattedMessage,{id:"wizard.certificateAuthority",defaultMessage:"Certificate authority"})},"endpoint.verify_ssl":{initialValue:!1}}}};function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ae=function hardcodedSchema(e,t,n){return p(ne,[e,"authentication",t,n],void 0)},re=function getAdditionalSteps(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"additionalSteps"],[])},oe=function shouldSkipSelection(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"skipSelection"],!1)},ie=function shouldSkipEndpoint(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"skipEndpoint"],!1)},se=function hasCustomSteps(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"customSteps"],!1)},ce=function getAdditionalStepKeys(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"includeStepKeyFields"],[])},le=function getOnlyHiddenFields(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"onlyHiddenFields"],!1)},ue=function getAdditionalStepFields(e,t){return e.filter((function(e){return e.stepKey===t})).map((function(e){e.stepKey;return S(e,["stepKey"])}))},de=function shouldUseAppAuth(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"useApplicationAuth"],!1)},pe=function getNoStepsFields(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter((function(e){return!e.stepKey||t.includes(e.stepKey)}))},me=function injectAuthFieldsInfo(e,t,n,a){return e.map((function(e){var r=p(ne,[t,"authentication",n,a]),o=r?p(r,e.name):p(ne,[t,"authentication",n,"generic",e.name]),i=o?_objectSpread({},e,{},o):e;return"authentication.password"===i.name&&(i.component="authentication"),i}))},fe=function injectEndpointFieldsInfo(e,t){return e.map((function(e){var n=p(ne,[t,"endpoint",e.name]);return n?_objectSpread({},e,{},n):e}))},ge=function getAdditionalAuthFields(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return p(ne,[e,"authentication",t,n,"additionalFields"],[])},he=function getAdditionalEndpointFields(e){return p(ne,[e,"endpoint","additionalFields"],[])},ye=function createEndpointStep(e,t){return _objectSpread({},e,{fields:[].concat(D(he(t)),D(fe(e.fields,t))),name:"".concat(t,"-endpoint"),nextStep:"summary"})},Ee=function createAdditionalSteps(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"generic";return e.map((function(e){var i=e.name||"".concat(t,"-").concat(n,"-").concat(o,"-additional-step"),s=ie(t,n,o),c=se(t,n,o);return _objectSpread({name:i,nextStep:!a||s||c?"summary":"".concat(t,"-endpoint")},e,{fields:[].concat(D(me(e.fields,t,n,o)),D(me(ue(r,i),t,n,o)))})}))},ve=function createGenericAuthTypeSelection(e,t,n){var a=e.schema.authentication,r=a.length>1,i=D(t),l={};if(r)return a.forEach((function(a){var r=ce(e.name,a.type),o=ie(e.name,a.type,"generic"),u=le(e.name,a.type),d=u?a.fields.filter((function(e){return e.hideField})):a.fields;de(e.name,a.type)&&(i=[]),i.push({component:"auth-select",name:"auth_select",label:a.name,authName:a.type,validate:[{type:c.REQUIRED}],disableAuthType:n}),i.push({component:s.SUB_FORM,name:"".concat(a.type,"-subform"),className:"pf-u-pl-md",fields:[].concat(D(ge(e.name,a.type)),D(me(pe(d,r),e.name,a.type))),condition:{when:"auth_select",is:a.type},hideField:u}),l[a.type]=re(e.name,a.type).length>0?"".concat(e.name,"-").concat(a.type,"-generic-additional-step"):0!==t.length||o?"summary":"".concat(e.name,"-endpoint")})),{name:e.name,title:M.createElement(o.FormattedMessage,{id:"wizard.credentials",defaultMessage:"Credentials"}),fields:i,nextStep:{when:"auth_select",stepMapper:l}};var u=a[0],d="".concat(e.name,"-").concat(u.type,"-generic-additional-step"),p=ie(e.name,u.type,"generic"),m=re(e.name,u.type).length>0?d:0!==t.length||p?"summary":"".concat(e.name,"-endpoint"),f=ce(e.name,u.type),g=oe(e.name,u.type),h={};if(de(e.name,u.type)&&(i=[]),g){var y=re(e.name,u.type).find((function(e){return!e.name})),E=ue(u.fields,d);h=_objectSpread({},y,{fields:[].concat(D(i),D(me([].concat(D(y.fields),D(E)),e.name,u.type)))})}return _objectSpread({name:e.name,title:M.createElement(o.FormattedMessage,{id:"wizard.credentials",defaultMessage:"Credentials"}),fields:[].concat(D(i),D(ge(e.name,u.type)),D(me(pe(u.fields,f),e.name,u.type))),nextStep:m},h)},be=function createSpecificAuthTypeSelection(e,t,n,a){var r=e.schema.authentication,i=t.supported_authentication_types[e.name],l=i.length>1,u=D(n),d={};if(l)return r.filter((function(e){var t=e.type;return i.includes(t)})).forEach((function(r){var o=ae(e.name,r.type,t.name)?t.name:"generic";de(e.name,r.type,o)&&(u=[]);var i,l=ie(e.name,r.type,o),p=se(e.name,r.type,o);i=re(e.name,r.type,t.name).length>0?"".concat(e.name,"-").concat(r.type,"-").concat(t.name,"-additional-step"):0!==n.length||l||p?"summary":"".concat(e.name,"-endpoint");var m=ce(e.name,r.type,o),f=le(e.name,r.type,o),g=f?r.fields.filter((function(e){return e.hideField})):r.fields;u.push({component:"auth-select",name:"auth_select",label:r.name,authName:r.type,validate:[{type:c.REQUIRED}],supportedAuthTypes:t.supported_authentication_types[e.name],disableAuthType:a}),u.push({component:s.SUB_FORM,name:"".concat(r.type,"-subform"),className:"pf-u-pl-md",fields:[].concat(D(ge(e.name,r.type,o)),D(me(pe(g,m),e.name,r.type,o))),condition:{when:"auth_select",is:r.type},hideField:f}),d[r.type]=i})),{name:"".concat(e.name,"-").concat(t.id),title:M.createElement(o.FormattedMessage,{id:"wizard.chooseAuthType",defaultMessage:"Choose authentication type"}),fields:u,nextStep:{when:"auth_select",stepMapper:d}};var p,m=r.find((function(e){var t=e.type;return i.includes(t)})),f=ae(e.name,m.type,t.name)?t.name:"generic",g="".concat(e.name,"-").concat(m.type,"-").concat(t.name,"-additional-step"),h=ie(e.name,m.type,f),y=se(e.name,m.type,f);de(e.name,m.type,f)&&(u=[]),p=re(e.name,m.type,f).length>0?g:0!==n.length||h?"summary":"".concat(e.name,"-endpoint");var E=ce(e.name,m.type,f),v={};if(oe(e.name,m.type,f)){var b=re(e.name,m.type,f).find((function(e){return!e.name})),T=ue(m.fields,g);p=b.nextStep?b.nextStep:0!==n.length||h||y?"summary":"".concat(e.name,"-endpoint"),v=_objectSpread({},b,{fields:[].concat(D(u),D(me([].concat(D(b.fields),D(T)),e.name,m.type,f)))})}return _objectSpread({name:"".concat(e.name,"-").concat(t.id),title:M.createElement(o.FormattedMessage,{id:"wizard.credentials",defaultMessage:"Credentials"}),fields:[].concat(D(u),D(ge(e.name,m.type,f)),D(me(pe(m.fields,E),e.name,m.type,f))),nextStep:p},v)},Me=function schemaBuilder(e,t,n){var a=[];return e.forEach((function(e){var r=e.schema.endpoint.hidden?e.schema.endpoint.fields:[],o=0===r.length;a.push(ve(e,r,n)),t.forEach((function(t){t.supported_source_types.includes(e.name)&&a.push(be(e,t,r,n))})),e.schema.authentication.forEach((function(n){var r=re(e.name,n.type);r.length>0&&a.push.apply(a,D(Ee(r,e.name,n.type,o,n.fields))),t.forEach((function(t){var r=re(e.name,n.type,t.name);r.length>0&&a.push.apply(a,D(Ee(r,e.name,n.type,o,n.fields,t.name)))}))})),o&&a.push(ye(e.schema.endpoint,e.name))})),a},Te=Object.freeze({__proto__:null,acronymMapper:function acronymMapper(e){return{"Amazon Web Services":"AWS"}[e]||e},hardcodedSchema:ae,getAdditionalSteps:re,shouldSkipSelection:oe,shouldSkipEndpoint:ie,hasCustomSteps:se,getAdditionalStepKeys:ce,getOnlyHiddenFields:le,getAdditionalStepFields:ue,shouldUseAppAuth:de,getNoStepsFields:pe,injectAuthFieldsInfo:me,injectEndpointFieldsInfo:fe,getAdditionalAuthFields:ge,getAdditionalEndpointFields:he,createEndpointStep:ye,createAdditionalSteps:Ee,createGenericAuthTypeSelection:ve,createSpecificAuthTypeSelection:be,schemaBuilder:Me}),we=function ValuePopover(e){var t=e.label,a=e.value,r=o.useIntl();return M.createElement(n.Popover,{headerContent:t,bodyContent:a,position:"top",maxWidth:"80%"},M.createElement(n.Button,{variant:"link",isInline:!0,className:"ins-c-sources__wizard--summary-buttonss"},r.formatMessage({id:"wizard.showMore",defaultMessage:"Show more"})))};we.propTypes={label:a.node,value:a.node};var Se=function getAllFieldsValues(e,t,n){return e.map((function(e){return function createItem(e,t,n){var a=p(t,e.name);if((!e.stepKey||n.includes(e.stepKey))&&!(e.condition&&p(t,e.condition.when)!==e.condition.is||e.hideField))return a&&"password"===e.type&&(a="●●●●●●●●●●●●"),"boolean"==typeof a&&(a=a?M.createElement(o.FormattedMessage,{id:"wizard.yes",defaultMessage:"Yes"}):M.createElement(o.FormattedMessage,{id:"wizard.no",defaultMessage:"No"})),!a&&"authentication.password"===e.name&&p(t,"authentication.id")&&(a="●●●●●●●●●●●●"),{label:e["aria-label"]||e.label,value:a||"-"}}(e,t,n)})).filter(Boolean)},xe=function SourceWizardSummary(e){var t,a=e.sourceTypes,r=e.applicationTypes,i=e.showApp,s=e.showAuthType,c=f(),l=o.useIntl(),u=c.getState().values,d=a.find((function(e){return e.name===u.source_type||e.id===u.source.source_type_id})),m=u.authentication&&u.authentication.authtype?u.authentication.authtype:u.auth_select,g=[];m&&(t=d.schema.authentication.find((function(e){return e.type===m})),g=t&&t.fields?t.fields:[]);var h=u.application?r.find((function(e){return e.id===u.application.application_type_id})):void 0,y=h||{},E=y.display_name,v=void 0===E?l.formatMessage({id:"wizard.notSelected",defaultMessage:"Not selected"}):E,b=y.name,T=y.id,w=ie(d.name,m,b),S=d.schema.endpoint.fields;w&&(S=[],g=g.filter((function(e){return!e.name.includes("authentication.")})));var x=function getStepKeys(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic",a=arguments.length>3?arguments[3]:void 0;return[].concat(D(p(ne,[e,"authentication",t,n,"includeStepKeyFields"],[])),D(p(ne,[e,"authentication",t,n,"additionalSteps"],[]).map((function(e){return e.name}))),["".concat(e,"-").concat(t,"-").concat(n,"-additional-step"),"".concat(e,"-").concat(t,"-additional-step"),a?"".concat(e,"-").concat(a):void 0]).filter(Boolean)}(d.name,m,b,T),_=re(d.name,m,b),A=p(ne,[d.name,"authentication",m,b,"customSteps"],!1);_.length>0&&(g=_.map((function(e){return[].concat(D(e.fields),D(g.filter((function(t){var n=t.stepKey;return n&&e.name===n}))))})).flatMap((function(e){return e})).filter((function(e){var t=e.name;return g.find((function(e){return e.name===t}))||A&&S.find((function(e){return e.name===t}))}))),A&&(S=[]),g=me(g,d.name,m,b||"generic"),S=fe(S,d.name);var I=[].concat(D(g),D(S)),C=Se(I,u,x).map((function(e){var t=e.label,a=e.value;return(M.createElement(M.Fragment,{key:"".concat(t,"--").concat(a)},M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},t),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},a.toString().length>150?M.createElement(we,{label:t,value:a}):a)))}));return M.createElement(M.Fragment,null,M.createElement(n.TextContent,null,M.createElement(n.TextList,{component:n.TextListVariants.dl},M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},l.formatMessage({id:"wizard.name",defaultMessage:"Name"})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},u.source.name),i&&M.createElement(M.Fragment,null,M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},l.formatMessage({id:"wizard.application",defaultMessage:"Application"})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},v)),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},l.formatMessage({id:"wizard.sourceType",defaultMessage:"Source type"})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},d.product_name),!w&&t&&s&&M.createElement(M.Fragment,null,M.createElement(n.TextListItem,{component:n.TextListItemVariants.dt},l.formatMessage({id:"wizard.authenticationType",defaultMessage:"Authentication type"})),M.createElement(n.TextListItem,{component:n.TextListItemVariants.dd},t.name)),C)),"/insights/platform/cost-management"===b&&M.createElement(n.Alert,{variant:"info",isInline:!0,title:l.formatMessage({id:"cost.rbacWarningTitle",defaultMessage:"Manage permissions in User Access"})},l.formatMessage({id:"cost.rbacWarningDescription",defaultMessage:"Make sure to manage permissions for this source in custom roles that contain permissions for Cost Management."})))};xe.propTypes={sourceTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,product_name:a.string.isRequired,schema:a.shape({authentication:a.array,endpoint:a.object})})).isRequired,applicationTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,display_name:a.string.isRequired})).isRequired,showApp:a.bool,showAuthType:a.bool},xe.defaultProps={showApp:!0,showAuthType:!0};var _e=function Description(e){var t=e.Content,n=S(e,["Content"]);return(M.createElement(t,n))};_e.propTypes={Content:a.oneOfType([a.element,a.func]).isRequired};var Ae=function CardSelect(e){var a=h(e),r=a.isRequired,o=a.label,i=a.helperText,s=a.hideLabel,c=a.meta,l=a.input,u=a.options,d=a.mutator,p=a.DefaultIcon,m=a.iconMapper,g=S(a,["isRequired","label","helperText","hideLabel","meta","input","options","mutator","DefaultIcon","iconMapper"]),y=f(),E=t.useState((function(){var e={};return u.forEach((function(t){var n=t.value;return e[n]=m(n,p)})),e})),v=O(E,1)[0],b=g.isMulti||g.multi,T=g.isDisabled||g.isReadOnly,w=l.value||[],x=function handleClick(e){return b?function handleMulti(e){return l.onChange(w.includes(e)?w.filter((function(t){return t!==e})):[].concat(D(w),[e]))}(e):function handleSingle(e){return l.onChange(w===e?void 0:e)}(e)},_=function onClick(e){T||(x(e),l.onBlur())},A=c.error,I=c.touched&&A;return M.createElement(n.FormGroup,{isRequired:r,label:!s&&o,fieldId:l.name,helperText:i,helperTextInvalid:A,validated:I?"error":"default"},M.createElement(n.Grid,{hasGutter:!0,className:"pf-u-mb-md"},function prepareCards(){return u.map((function(e){return d(e,y)})).map((function(e){var t=e.value,a=e.label,r=e.isDisabled||T;if(t){var o=v[t];return(M.createElement(n.GridItem,{sm:6,md:4,key:t},M.createElement(n.Card,{className:"ins-c-sources__wizard--card".concat(w.includes(t)?" selected":"").concat(r?" disabled":""),onClick:function onClick(){return _(t)},tabIndex:r?-1:0,onKeyPress:function onKeyPress(e){return function handleKeyPress(e,t,n){32===e.charCode&&(e.preventDefault(),n(t))}(e,t,_)},isHoverable:!r,isCompact:!0},M.createElement("div",{className:r?"disabled":""},!o&&M.createElement(n.CardTitle,{className:"text-elipsis"},a),o&&M.createElement(n.CardBody,null,M.createElement(n.Bullseye,null,M.createElement(o,{size:"md"})))))))}}))}()))};Ae.propTypes={multi:a.bool,isMulti:a.bool,label:a.node,isRequired:a.bool,helperText:a.node,description:a.node,hideLabel:a.bool,name:a.string.isRequired,mutator:a.func,options:a.array,DefaultIcon:a.oneOfType([a.node,a.func,a.element]),iconMapper:a.func,isDisabled:a.bool,isReadOnly:a.bool},Ae.defaultProps={options:[],iconMapper:function iconMapper(e,t){return t},mutator:function mutator(e){return e}};var Ie=function AuthRadio(e){var t=h(e),a=t.label,r=t.input,o=t.authName,i=t.supportedAuthTypes,s=t.disableAuthType,c=r.value===o;return r.value&&i&&!i.includes(r.value)&&r.onChange(void 0),M.createElement(n.Radio,{value:o,isChecked:c,name:r.name,onChange:function onChange(){return r.onChange(o)},label:a,id:"".concat(r.name,"-").concat(o),isDisabled:s})};function ownKeys$1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}Ie.propTypes={label:a.string,authName:a.string.isRequired,disableAuthType:a.bool,supportedAuthTypes:a.arrayOf(a.string)},Ie.defaultProps={disableAuthType:!1};var Ce=function EnhancedSelect(e){var t=e.mutator,n=e.options,a=S(e,["mutator","options"]),r=f();return M.createElement("div",{className:"ins-c-sources__wizard--bigdescription"},M.createElement(y,T({},a,{options:n.map((function(e){return t(e,r)}))})))};function ownKeys$2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$2(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Ce.propTypes={mutator:a.func.isRequired,options:a.array};var Oe={"auth-select":Ie,description:_e,"card-select":Ae,summary:xe,authentication:function Authentication(e){var t=o.useIntl(),n=f().getState().values.authentication,a=e.validate&&e.validate.filter((function(e){return e.type!==c.REQUIRED})),r=function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$1(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},n&&n.id?{isRequired:!1,helperText:t.formatMessage({id:"wizard.changeAuthHelper",defaultMessage:"Changing this resets your current {label}."},{label:e.label}),validate:a}:{}),i=d[s.TEXT_FIELD];return M.createElement(i,r)},"enhanced-select":Ce},Fe=function FormTemplateWrapper(e){return M.createElement(u,T({},e,{showFormControls:!1}))},Re=function SourcesFormRenderer(e){return M.createElement(i,T({componentMapper:_objectSpread$2({},d,{},Oe,{"switch-field":d[s.SWITCH]}),validatorMapper:{"required-validator":l[c.REQUIRED],"pattern-validator":l[c.PATTERN],"min-length-validator":l[c.MIN_LENGTH],"url-validator":l[c.URL]},FormTemplate:Fe,subscription:{values:!0}},e))},Le=createCommonjsModule((function(e){var t=function(e){var t,n=Object.prototype,a=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function wrap(e,t,n,a){var r=t&&t.prototype instanceof Generator?t:Generator,o=Object.create(r.prototype),i=new Context(a||[]);return o._invoke=function makeInvokeMethod(e,t,n){var a=c;return function invoke(r,o){if(a===u)throw new Error("Generator is already running");if(a===d){if("throw"===r)throw o;return doneResult()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var s=maybeInvokeDelegate(i,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===c)throw a=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=u;var m=tryCatch(e,t,n);if("normal"===m.type){if(a=n.done?d:l,m.arg===p)continue;return{value:m.arg,done:n.done}}"throw"===m.type&&(a=d,n.method="throw",n.arg=m.arg)}}}(e,n,i),o}function tryCatch(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=wrap;var c="suspendedStart",l="suspendedYield",u="executing",d="completed",p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var m={};m[o]=function(){return this};var f=Object.getPrototypeOf,g=f&&f(f(values([])));g&&g!==n&&a.call(g,o)&&(m=g);var h=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(m);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function AsyncIterator(e,t){var n;this._invoke=function enqueue(r,o){function callInvokeWithMethodAndArg(){return new t((function(n,i){!function invoke(n,r,o,i){var s=tryCatch(e[n],e,r);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,o,i)}),(function(e){invoke("throw",e,o,i)})):t.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return invoke("throw",e,o,i)}))}i(s.arg)}(r,o,n,i)}))}return n=n?n.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(e,n){var a=e.iterator[n.method];if(a===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,maybeInvokeDelegate(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=tryCatch(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function next(){for(;++r<e.length;)if(a.call(e,r))return next.value=e[r],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:t,done:!0}}return GeneratorFunction.prototype=h.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[s]=GeneratorFunction.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[i]=function(){return this},e.AsyncIterator=AsyncIterator,e.async=function(t,n,a,r,o){void 0===o&&(o=Promise);var i=new AsyncIterator(wrap(t,n,a,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(h),h[s]="Generator",h[o]=function(){return this},h.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function next(){for(;t.length;){var n=t.pop();if(n in e)return next.value=n,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function handle(a,r){return i.type="throw",i.arg=e,n.next=a,r&&(n.method="next",n.arg=t),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return handle("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0);if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return handle(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return handle(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),resetTryEntry(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;resetTryEntry(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:values(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function asyncGeneratorStep(e,t,n,a,r,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}var ke=function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function _next(e){asyncGeneratorStep(o,a,r,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,a,r,_next,_throw,"throw",e)}_next(void 0)}))}},De=function ValidatorReset(e){var n=e.name,a=f();return t.useEffect((function(){return setTimeout((function(){return a.change(n,"1")})),function(){return a.change(n,"")}}),[]),null};De.propTypes={name:a.string.isRequired};var ze=function handleError(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e||(t="Undefined error"),t||"string"!=typeof e||(t=e),t||(t=p(e,"errors[0].detail",JSON.stringify(e,null,2))),n?U().deleteSource(n).then((function(){return t})).catch((function(e){var n=p(e,"errors[0].detail",JSON.stringify(e,null,2));return"".concat(t,". The source was not removed, try remove it later: ").concat(n)})):t},Pe=function ValidatingSpinner(e){var t=e.validating,a=o.useIntl();return M.createElement(n.FormHelperText,{isHidden:!t},M.createElement(n.Spinner,{size:"md",className:"pf-u-mr-md"}),a.formatMessage({id:"wizard.validating",defaultMessage:"Validating"}))};Pe.propTypes={validating:a.bool.isRequired};var je=function validated(e,t){var n=t.meta;return n.validating?{helperText:M.createElement(v,null,(function(e){var t=e.validating;return(M.createElement(Pe,{validating:t}))}))}:n.valid?{validated:"success",FormGroupProps:{validated:"success"}}:{}};function ownKeys$3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$3(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=function(){var e=ke(Le.mark((function _callee(e){var t,n,a,r=arguments;return Le.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(t=r.length>1&&void 0!==r[1]?r[1]:void 0,n=r.length>2?r[2]:void 0,e){o.next=4;break}return o.abrupt("return",void 0);case 4:return o.prev=4,o.next=7,G(e);case 7:a=o.sent,o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(4),console.error(ze(o.t0)),o.abrupt("return",void 0);case 14:if(!a.data.sources.find((function(e){return e.id!==t}))){o.next=16;break}throw n.formatMessage({defaultMessage:"That name is taken. Try another.",id:"wizard.nameTaken"});case 16:return o.abrupt("return",void 0);case 17:case"end":return o.stop()}}),_callee,null,[[4,10]])})));return function asyncValidator(t){return e.apply(this,arguments)}}(),Ne=!0,qe=function setFirstValidated(e){return Ne=e},Be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{onlyResolvesLast:!1};return E(e,t,n)}(Ve),We=function asyncValidatorDebouncedWrapper(e){return function getFirstValidated(){return Ne}()?(qe(!1),function(t,n){return t?Ve(t,n,e):void 0}):Be},Ue=function compileAllSourcesComboOptions(e){return D(e.sort((function(e,t){return e.product_name.localeCompare(t.product_name)})).map((function(e){return{value:e.name,label:e.product_name}})))},Ge=function compileAllApplicationComboOptions(e,t){return[{label:t.formatMessage({id:"wizard.none",defaultMessage:"None"}),key:"none"}].concat(D(e.sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){return{value:e.id,label:e.display_name}}))))},$e=function appMutator(e){return function(t,n){if(!t.value)return t;var a=n.getState().values.source_type,r=e.find((function(e){return e.display_name===t.label})),o=!a||r.supported_source_types.includes(a);return _objectSpread$3({},t,{isDisabled:!o})}},Ke=function sourceTypeMutator(e,t){return function(n,a){var r=a.getState().values.application?a.getState().values.application.application_type_id:void 0,o=e.find((function(e){return e.id===r})),i=!o||o.supported_source_types.includes(t.find((function(e){return e.product_name===n.label})).name);return _objectSpread$3({},n,{isDisabled:!i})}},He=function iconMapper(e){return function(t){var n=e.find((function(e){return e.name===t}));if(!n||!n.icon_url)return null;return function Icon(){return M.createElement("img",{src:n.icon_url,alt:n.product_name,className:"ins-c-sources__wizard--icon"})}}},Xe=function nextStep(e){var t=e.values,n=t.application,a=t.source_type,r=n&&n.application_type_id;return r?"".concat(a,"-").concat(r):a},Qe=function typesStep(e,t,n,a){return{title:a.formatMessage({id:"wizard.chooseAppAndType",defaultMessage:"Application and source type"}),name:"types_step",nextStep:Xe,fields:[{component:"enhanced-select",name:"application.application_type_id",label:a.formatMessage({id:"wizard.selectYourApplication",defaultMessage:"A. Select application"}),options:Ge(t,a),mutator:$e(t),description:a.formatMessage({id:"wizard.selectAppWarning",defaultMessage:"Selecting an application will limit the available source types. You can attach an application to this source using the dropdown below, or by clicking ‘Manage applications’ after source creation."}),isDisabled:n,placeholder:a.formatMessage({id:"wizard.chooseApp",defaultMessage:"Choose application"})},{component:"card-select",name:"source_type",isRequired:!0,label:a.formatMessage({id:"wizard.selectYourSourceType",defaultMessage:"B. Select source type"}),iconMapper:He(e),validate:[{type:c.REQUIRED}],options:Ue(e),mutator:Ke(t,e)},{component:"description",name:"fixasyncvalidation",Content:De}]}},Ye=function NameDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,{key:"step1"},M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.nameDescription",defaultMessage:"To import data for an application, you need to connect to a data source. Enter a name, then proceed to select your application and source type."}))))},Ze=function nameStep(e){return{title:e.formatMessage({id:"wizard.name",defaultMessage:"Name"}),name:"name_step",nextStep:"types_step",fields:[{component:"description",name:"description-summary",Content:Ye},{component:s.TEXT_FIELD,name:"source.name",type:"text",label:e.formatMessage({id:"wizard.name",defaultMessage:"Name"}),placeholder:"Source_1",isRequired:!0,validate:[function(t){return We(e)(t,void 0,e)},{type:c.REQUIRED}],resolveProps:je}]}},Je=function SummaryDescription(){var e=o.useIntl();return(M.createElement(n.TextContent,null,M.createElement(n.Text,{component:n.TextVariants.p},e.formatMessage({id:"wizard.summaryDescription",defaultMessage:"Review the information below and click Add to add your source. Use the Back button to make changes."}))))},et=function summaryStep(e,t,n){return{fields:[{component:"description",name:"description-summary",Content:Je},{name:"summary",component:"summary",sourceTypes:e,applicationTypes:t}],name:"summary",title:n.formatMessage({id:"wizard.reviewDetails",defaultMessage:"Review details"})}},createSchema=function(e,t,n,a,r){return qe(!0),{fields:[{component:s.WIZARD,name:"wizard",title:j,inModal:!0,description:P,buttonLabels:{submit:r.formatMessage({id:"sources.add",defaultMessage:"Add"}),back:r.formatMessage({id:"wizard.back",defaultMessage:"Back"}),cancel:r.formatMessage({id:"wizard.cancel",defaultMessage:"Cancel"}),next:r.formatMessage({id:"wizard.next",defaultMessage:"Next"})},container:a,showTitles:!0,crossroads:["application.application_type_id","source_type","auth_select"],fields:[Ze(r),Qe(e,t,n,r)].concat(D(Me(e,t)),[et(e,t,r)])}]}},tt=function LoadingStep(e){var t=e.onClose,a=e.customText,r=e.cancelTitle;return(M.createElement(n.Bullseye,null,M.createElement(n.EmptyState,{variant:n.EmptyStateVariant.full,className:"pf-u-mt-4xl"},M.createElement(n.EmptyStateIcon,{icon:n.Spinner,className:"pf-u-mb-0"}),M.createElement(n.Title,{headingLevel:"h2",size:"xl",className:"pf-u-mt-xl"},a),t&&M.createElement(n.EmptyStateSecondaryActions,{className:"pf-u-mt-xl"},M.createElement(n.Button,{variant:"link",onClick:t},r)))))};tt.propTypes={onClose:a.func,customText:a.node,cancelTitle:a.node},tt.defaultProps={customText:M.createElement(o.FormattedMessage,{id:"wizard.loadingText",defaultMessage:"Loading, please wait."}),cancelTitle:M.createElement(o.FormattedMessage,{id:"wizard.cancelText",defaultMessage:"Cancel"})};var nt=function filterApps(e){return"/insights/platform/topological-inventory"!==e.name},at=function filterTypes(e){var t,n;return(null===(t=e.schema)||void 0===t?void 0:t.authentication)&&(null===(n=e.schema)||void 0===n?void 0:n.endpoint)};function ownKeys$4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var rt={schema:{},sourceTypes:[],isLoading:!0},ot=function reducer(e,t){var n=t.type,a=t.sourceTypes,r=t.applicationTypes,o=t.container,i=t.disableAppSelection,s=t.intl;switch(n){case"loaded":return function _objectSpread$4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$4(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{schema:createSchema(a.filter(at),r.filter(nt),i,o,s),isLoading:!1,sourceTypes:a})}},it=function SourceAddModal(e){var a=e.sourceTypes,r=e.applicationTypes,i=e.disableAppSelection,s=e.isCancelling,c=e.onCancel,l=e.values,u=e.onSubmit,d=t.useReducer(ot,rt),p=O(d,2),m=p[0],f=m.schema,g=m.sourceTypes,h=m.isLoading,y=p[1],E=t.useRef(!1),v=t.useRef(document.createElement("div")),b=o.useIntl();return t.useEffect((function(){E.current=!0;var e=[];return a||e.push(function doLoadSourceTypes(){return U().listSourceTypes().then((function(e){return{sourceTypes:e.data}}))}()),r||e.push(function doLoadApplicationTypes(){return U().listApplicationTypes().then((function(e){return{applicationTypes:e.data}}))}()),Promise.all(e).then((function(e){var t=e.find((function(e){return e.hasOwnProperty("sourceTypes")})),n=e.find((function(e){return e.hasOwnProperty("applicationTypes")}));E.current&&y({type:"loaded",sourceTypes:a||t.sourceTypes,applicationTypes:r||n.applicationTypes,disableAppSelection:i,container:v.current,intl:b})})),function(){E.current=!1}}),[]),t.useEffect((function(){v.current.hidden=s}),[s]),h?M.createElement(n.Wizard,{isOpen:!0,onClose:c,title:j,description:P,steps:[{name:"Loading",component:M.createElement(tt,{onClose:function onClose(){return c()}}),isFinishedStep:!0}]}):M.createElement(Re,{initialValues:l,schema:f,onSubmit:function onSubmit(e){return u(e,g)},onCancel:c})};it.propTypes={onCancel:a.func.isRequired,onSubmit:a.func.isRequired,sourceTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,product_name:a.string.isRequired,schema:a.shape({authentication:a.array,endpoint:a.object})})),applicationTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,display_name:a.string.isRequired})),values:a.object,disableAppSelection:a.bool,isCancelling:a.bool},it.defaultProps={values:{},disableAppSelection:!1};var st=function FinishedStep(e){var t=e.onClose,a=e.successfulMessage,r=e.hideSourcesButton,o=e.returnButtonTitle,i=e.title,s=e.linkText,c=e.secondaryActions;return(M.createElement(n.Bullseye,null,M.createElement(n.EmptyState,{variant:n.EmptyStateVariant.full,className:"pf-u-mt-4xl"},M.createElement(n.EmptyStateIcon,{icon:m.CheckCircleIcon,color:"var(--pf-global--success-color--100)",className:"pf-u-mb-0"}),M.createElement(n.Title,{headingLevel:"h2",size:"xl",className:"pf-u-mt-xl"},i),M.createElement(n.EmptyStateBody,{className:"ins-c-sources__wizard--step-text"},a),M.createElement(n.Button,{variant:"primary",onClick:t,className:"pf-u-mt-xl"},o),!r&&M.createElement(n.EmptyStateSecondaryActions,null,M.createElement("a",{href:"/hybrid/settings/sources"},M.createElement(n.Button,{variant:"link"},s))),c&&M.createElement(n.EmptyStateSecondaryActions,null,c))))};st.propTypes={onClose:a.func.isRequired,successfulMessage:a.node.isRequired,hideSourcesButton:a.bool,returnButtonTitle:a.node.isRequired,title:a.node,linkText:a.node,secondaryActions:a.node},st.defaultProps={title:M.createElement(o.FormattedMessage,{id:"wizard.succConfiguration",defaultMessage:"Configuration successful"}),linkText:M.createElement(o.FormattedMessage,{id:"wizard.toSources",defaultMessage:"Take me to sources"})};var ct=function ErroredStep(e){var t=e.onClose,a=e.returnButtonTitle,r=e.message,o=e.title,i=e.customText,s=e.primaryAction,c=e.secondaryActions,l=e.Component;return(M.createElement(n.Bullseye,null,M.createElement(n.EmptyState,{variant:n.EmptyStateVariant.full,className:"pf-u-mt-4xl"},M.createElement(n.EmptyStateIcon,{icon:m.ExclamationCircleIcon,color:"var(--pf-global--danger-color--100)",className:"pf-u-mb-0"}),M.createElement(n.Title,{headingLevel:"h2",size:"xl",className:"pf-u-mt-xl"},o),M.createElement(n.EmptyStateBody,{className:"ins-c-sources__wizard--step-text"},r||i),M.createElement(l,{variant:"primary",onClick:s||t},a),c&&M.createElement(n.EmptyStateSecondaryActions,{className:"pf-u-mt-sm"},c))))};ct.propTypes={onClose:a.func.isRequired,returnButtonTitle:a.node,message:a.node,title:a.node,customText:a.node,primaryAction:a.func,secondaryActions:a.node,Component:a.elementType},ct.defaultProps={title:M.createElement(o.FormattedMessage,{id:"wizard.unsuccConfiguration",defaultMessage:"Something went wrong"}),customText:M.createElement(o.FormattedMessage,{id:"wizard.errorText",defaultMessage:"There was a problem while trying to add your source. Please try again. If the error persists, open a support case."}),Component:n.Button};var lt=function TimeoutStep(e){var t=e.onClose,a=e.returnButtonTitle,r=e.title,i=e.secondaryActions,s=o.useIntl();return M.createElement(n.Bullseye,null,M.createElement(n.EmptyState,{variant:n.EmptyStateVariant.full,className:"pf-u-mt-4xl"},M.createElement(n.EmptyStateIcon,{icon:m.WrenchIcon,color:"var(--pf-global--Color--200)",className:"pf-u-mb-0"}),M.createElement(n.Title,{headingLevel:"h2",size:"xl",className:"pf-u-mt-xl"},r),M.createElement(n.EmptyStateBody,null,s.formatMessage({id:"wizard.uncompleteConfigurationDescription",defaultMessage:"We are still working to confirm credentials and app settings.{newLine}To track progress, check the Status column in the Sources table."},{newLine:M.createElement("br",{key:"br"})})),M.createElement(n.Button,{variant:"primary",onClick:t,className:"pf-u-mt-xl"},a),i&&M.createElement(n.EmptyStateSecondaryActions,null,i)))};lt.propTypes={onClose:a.func.isRequired,returnButtonTitle:a.node.isRequired,title:a.node,secondaryActions:a.node},lt.defaultProps={title:M.createElement(o.FormattedMessage,{id:"wizard.uncompleteConfigurationTitle",defaultMessage:"Configuration not yet complete"})};var ut=function FinalWizard(e){var a,r=e.afterSubmit,i=e.afterError,s=e.isFinished,c=e.isErrored,l=e.successfulMessage,u=e.hideSourcesButton,d=e.returnButtonTitle,p=e.reset,m=e.createdSource,f=void 0===m?{}:m,g=e.tryAgain,h=e.afterSuccess,y=t.useState(),E=O(y,2),v=E[0],T=E[1],w=t.useState(),S=O(w,2),x=S[0],_=S[1],A=o.useIntl();if(x)a=M.createElement(st,{onClose:r,title:A.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:A.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:u,returnButtonTitle:d,secondaryActions:M.createElement(n.Button,{variant:"link",onClick:p},A.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))});else if(v)a=M.createElement(tt,{customText:A.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(s){var I,C;if("available"===(null===(I=f.applications[0])||void 0===I?void 0:I.availability_status))a=M.createElement(st,{onClose:r,successfulMessage:l,hideSourcesButton:u,returnButtonTitle:d,secondaryActions:M.createElement(n.Button,{variant:"link",onClick:p},A.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))});else if("unavailable"===(null===(C=f.applications[0])||void 0===C?void 0:C.availability_status)){var F;a=M.createElement(ct,{onClose:r,secondaryActions:M.createElement(n.Button,{variant:"link",onClick:function removeSource(){return T(!0),U().removeSource(f.id).then((function(){h&&h(),_(!0)})).catch((function(){return T(!1)}))}},A.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function Component(){return M.createElement(b.Link,{to:"/sources/edit/".concat(f.id)},M.createElement(n.Button,{variant:"primary",className:"pf-u-mt-xl"},A.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))},message:(null===(F=f.applications[0])||void 0===F?void 0:F.availability_status_error)||A.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:A.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})})}else a=f.applications[0]?M.createElement(lt,{onClose:r,returnButtonTitle:d,secondaryActions:M.createElement(n.Button,{variant:"link",onClick:p},A.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))}):M.createElement(st,{onClose:r,successfulMessage:l,hideSourcesButton:u,returnButtonTitle:d,secondaryActions:M.createElement(n.Button,{variant:"link",onClick:p},A.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))})}else a=c?M.createElement(ct,{onClose:i,primaryAction:g,secondaryActions:M.createElement(n.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},A.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:A.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):M.createElement(tt,{customText:A.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating source credentials"}),onClose:i,cancelTitle:A.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return(M.createElement(n.Wizard,{isOpen:!0,onClose:s?r:i,title:j,description:P,steps:[{name:"Finish",component:a,isFinishedStep:!0}]}))};ut.propTypes={afterSubmit:a.func.isRequired,afterError:a.func.isRequired,isFinished:a.bool.isRequired,isErrored:a.bool.isRequired,successfulMessage:a.node.isRequired,hideSourcesButton:a.bool,returnButtonTitle:a.node.isRequired,errorMessage:a.node,reset:a.func,createdSource:a.object,tryAgain:a.func,afterSuccess:a.func};var dt=function delay(e,t){return new Promise((function(n){setTimeout(n.bind(null,t),e)}))};function patchSource(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((function(a,r){var o=Date.now(),i=e.id,s=S(e,["id"]);return function checkSource(){return W.get("".concat(B,"/sources/").concat(i,"/")).catch((function(e){return Date.now()-o>=t?Promise.reject("Cost Management failed tracking source: ".concat(JSON.stringify(e))):dt(n).then((function(){return checkSource()}))}))}().then((function(){return W.patch("".concat(B,"/sources/").concat(i,"/"),s)})).then((function(e){return a(e)})).catch((function(e){return r(e)}))}))}var pt=function checkAppAvailability(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((function(a,r){var o=Date.now();return function checkSource(){return U().getApplication(e).then((function(e){var a=Date.now()-o>=t;return"available"===e.availability_status||"unavailable"===e.availability_status||a?e:dt(n).then((function(){return checkSource()}))}))}().then((function(e){return a(e)})).catch((function(e){return r(e)}))}))};function ownKeys$5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread$5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$5(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mt=function parseUrl(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}},ft=function urlOrHost(e){return e.url?mt(e.url):e},gt=function(){var e=ke(Le.mark((function _callee2(e,t){var n,a,r,o,i,s,c,l,u,d,p,m,f,g,h,y,E,v,b,M,T,w,S,x,_,A,I=arguments;return Le.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:return n=I.length>2&&void 0!==I[2]?I[2]:[],C.prev=1,o=t.find((function(t){return t.name===e.source_type})).id,C.next=5,U().createSource(_objectSpread$5({},e.source,{source_type_id:o}));case 5:return a=C.sent,i=[],e.endpoint?(s=ft(e),c=s.scheme,l=s.host,u=s.port,d=s.path,p=parseInt(u,10),m=_objectSpread$5({},e.endpoint,{default:!0,source_id:a.id,scheme:c,host:l,port:isNaN(p)?void 0:p,path:d}),i.push(U().createEndpoint(m))):i.push(Promise.resolve(void 0)),e.application&&e.application.application_type_id?(f=_objectSpread$5({},e.application,{source_id:a.id}),i.push(U().createApplication(f))):i.push(Promise.resolve(void 0)),C.next=11,Promise.all(i);case 11:if(g=C.sent,h=O(g,2),y=h[0],E=h[1],!(y||e.authentication&&(null===(r=E)||void 0===r?void 0:r.id))){C.next=20;break}return M=_objectSpread$5({},e.authentication,{resource_id:(null==y?void 0:y.id)||(null===(b=E)||void 0===b?void 0:b.id),resource_type:(null==y?void 0:y.id)?"Endpoint":"Application"}),C.next=19,U().createAuthentication(M);case 19:v=C.sent;case 20:return T=[],e.credentials||e.billing_source?(w=e.credentials,S=e.billing_source,x={},x=w?{authentication:{credentials:w}}:{},x=S?_objectSpread$5({},x,{billing_source:S}):x,T.push(patchSource(_objectSpread$5({id:a.id},x)))):i.push(Promise.resolve(void 0)),v&&E?(_={application_id:E.id,authentication_id:v.id},T.push(U().createAuthApp(_))):i.push(Promise.resolve(void 0)),C.next=25,Promise.all(T);case 25:if(!E){C.next=30;break}return A=n.includes(E.application_type_id)?1e4:0,C.next=29,pt(E.id,A);case 29:E=C.sent;case 30:return C.abrupt("return",_objectSpread$5({},a,{endpoint:[y],applications:[E]}));case 33:return C.prev=33,C.t0=C.catch(1),C.next=37,ze(C.t0,a?a.id:void 0);case 37:throw C.sent;case 39:case"end":return C.stop()}}),_callee2,null,[[1,33]])})));return function doCreateSource(t,n){return e.apply(this,arguments)}}(),ht=function CloseModal(e){var t=e.onExit,a=e.onStay,r=e.isOpen,i=e.title,s=e.exitTitle,c=e.stayTitle,l=e.description,u=o.useIntl();return M.createElement(n.Modal,{variant:"small",title:i,"aria-label":u.formatMessage({id:"wizard.closeAriaLabel",defaultMessage:"Close add source wizard"}),header:M.createElement(n.Title,{headingLevel:"h1",size:"2xl"},M.createElement(m.ExclamationTriangleIcon,{size:"sm",className:"ins-c-source__warning-icon"}),i),isOpen:r,onClose:a,actions:[M.createElement(n.Button,{key:"confirm",variant:"primary",id:"on-exit-button",onClick:t},s),M.createElement(n.Button,{key:"cancel",variant:"link",id:"on-stay-button",onClick:a},c)]},l)};function ownKeys$6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread$6(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$6(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$6(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}ht.propTypes={onExit:a.func.isRequired,onStay:a.func.isRequired,isOpen:a.bool.isRequired,title:a.node,exitTitle:a.node,stayTitle:a.node,description:a.node},ht.defaultProps={title:M.createElement(o.FormattedMessage,{id:"wizard.closeTitle",defaultMessage:"Exit source creation?"}),exitTitle:M.createElement(o.FormattedMessage,{id:"wizard.exitText",defaultMessage:"Exit"}),stayTitle:M.createElement(o.FormattedMessage,{id:"wizard.stayText",defaultMessage:"Stay"}),description:M.createElement(o.FormattedMessage,{id:"wizard.closeWarning",defaultMessage:"All inputs will be discarded."})};var yt=function prepareInitialValues(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},Et=function reducer(e,t){var n=t.type,a=t.values,r=t.data,o=t.error,i=t.initialValues,s=t.sourceTypes;switch(n){case"reset":return yt(i);case"prepareSubmitState":return _objectSpread$6({},e,{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:a,sourceTypes:s});case"setSubmitted":return _objectSpread$6({},e,{isFinished:!0,createdSource:r});case"setErrored":return _objectSpread$6({},e,{isErrored:!0,error:o.toString()});case"onStay":return _objectSpread$6({},e,{isCancelling:!1});case"showCancelModal":return _objectSpread$6({},e,{isCancelling:!0,values:a})}},vt=function AddSourceWizard(e){var n=e.successfulMessage,a=e.isOpen,o=e.sourceTypes,i=e.applicationTypes,s=e.disableAppSelection,c=e.hideSourcesButton,l=e.returnButtonTitle,u=e.initialValues,d=e.onClose,p=e.afterSuccess,m=t.useReducer(Et,yt(u)),f=O(m,2),g=f[0],h=g.isErrored,y=g.isFinished,E=g.isSubmitted,v=g.values,b=g.error,T=g.isCancelling,w=g.createdSource,x=S(g,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),_=f[1],A=function onSubmit(e,t){return _({type:"prepareSubmitState",values:e,sourceTypes:t}),gt(e,t,function timeoutedApps(e){var t,n;return[null===(t=e.find((function(e){return"/insights/platform/cloud-meter"===e.name})))||void 0===t?void 0:t.id,null===(n=e.find((function(e){return"/insights/platform/cost-management"===e.name})))||void 0===n?void 0:n.id]}(i)).then((function(e){p&&p(e),_({type:"setSubmitted",data:e})})).catch((function(e){_({type:"setErrored",error:e})}))};return a?E?M.createElement(ut,{afterSubmit:function afterSubmit(){d(void 0,w),_({type:"reset",initialValues:u})},afterError:function afterError(){return d({})},isFinished:y,isErrored:h,successfulMessage:n,hideSourcesButton:c,returnButtonTitle:l,errorMessage:b,reset:function reset(){return _({type:"reset",initialValues:u})},createdSource:w,tryAgain:function tryAgain(){return A(v,x.sourceTypes)},afterSuccess:p}):M.createElement(M.Fragment,null,M.createElement(ht,{isOpen:T,onExit:function onExit(){return d(v)},onStay:function onStay(){return _({type:"onStay"})}}),M.createElement(it,{isCancelling:T,values:v,onSubmit:A,onCancel:function onCancelBeforeExit(e){return r(e)?d({}):_({type:"showCancelModal",values:e})},sourceTypes:o,applicationTypes:i,disableAppSelection:s})):null};vt.propTypes={afterSuccess:a.func,sourceTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,product_name:a.string.isRequired,schema:a.shape({authentication:a.array,endpoint:a.object})})),applicationTypes:a.arrayOf(a.shape({id:a.string.isRequired,name:a.string.isRequired,display_name:a.string.isRequired})),onClose:a.func.isRequired,isOpen:a.bool.isRequired,successfulMessage:a.node,initialValues:a.shape(F({},a.string,a.oneOf([a.string,a.array,a.number,a.bool]))),disableAppSelection:a.bool,hideSourcesButton:a.bool,returnButtonTitle:a.node},vt.defaultProps={successfulMessage:M.createElement(o.FormattedMessage,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:M.createElement(o.FormattedMessage,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};e.AddSourceButton=function AddSourceButton(e){var a=t.useState(!1),r=O(a,2),o=r[0],i=r[1];return(M.createElement(M.Fragment,null,M.createElement(n.Button,{variant:"primary",onClick:function onClick(){return i(!0)}},j),M.createElement(vt,T({isOpen:o,onClose:function onClose(){return i(!1)}},e))))},e.AddSourceWizard=vt,e.AuthSelect=Ie,e.CardSelect=Ae,e.CloseModal=ht,e.ErroredStep=ct,e.FinishedStep=st,e.LoadingStep=tt,e.SourceWizardSummary=xe,e.SummaryStep=xe,e.asyncValidator=Be,e.asyncValidatorDebouncedWrapper=We,e.asyncValidatorRaw=Ve,e.filterApps=nt,e.handleError=ze,e.hardcodedSchemas=ne,e.mapperExtension=Oe,e.parseUrl=mt,e.patchSource=patchSource,e.schemaBuilder=Te,e.setFirstValidated=qe,e.urlOrHost=ft,Object.defineProperty(e,"__esModule",{value:!0})}));

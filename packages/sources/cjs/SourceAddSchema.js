"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0}),require("./_commonjsHelpers-32c5d30b.js"),require("./objectWithoutProperties-9e2b4e81.js"),require("./slicedToArray-359307e9.js");var defineProperty=require("./defineProperty-cf06dcaa.js"),React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),reactIntl=require("react-intl"),componentTypes=_interopDefault(require("@data-driven-forms/react-form-renderer/dist/cjs/component-types")),validatorTypes=_interopDefault(require("@data-driven-forms/react-form-renderer/dist/cjs/validator-types")),toConsumableArray=require("./toConsumableArray-fe9ed082.js"),TextContent_js=require("@patternfly/react-core/dist/js/components/Text/TextContent.js");require("@patternfly/react-core/dist/js/components/Text/TextListItem.js"),require("@patternfly/react-core/dist/js/components/Text/TextList.js"),require("lodash/get"),require("@patternfly/react-core/dist/js/components/Form/FormHelperText.js"),require("@patternfly/react-icons/dist/js/icons/question-circle-icon"),require("@patternfly/react-core/dist/js/components/Popover/Popover.js");var Text_js=require("@patternfly/react-core/dist/js/components/Text/Text.js"),hardcodedSchemas=require("./hardcodedSchemas-11027244.js");require("@patternfly/react-core/dist/js/components/ClipboardCopy/ClipboardCopy.js");var useFormApi=_interopDefault(require("@data-driven-forms/react-form-renderer/dist/cjs/use-form-api"));require("@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors"),require("./constants.js");var index=require("./index-1dfedd03.js"),schemaBuilder=require("./schemaBuilder-3e86f68c.js"),asyncToGenerator=require("./asyncToGenerator-a32dc547.js"),awesomeDebouncePromise=_interopDefault(require("awesome-debounce-promise")),handleError=require("./handleError.js");require("@patternfly/react-core/dist/js/components/Spinner/Spinner.js"),require("@data-driven-forms/react-form-renderer/dist/cjs/form-spy");var validated=require("./validated.js"),debouncePromise=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{onlyResolvesLast:!1};return awesomeDebouncePromise(e,t,r)},ValidatorReset=function ValidatorReset(e){var t=e.name,r=useFormApi();return React.useEffect((function(){return setTimeout((function(){return r.change(t,"1")})),function(){return r.change(t,"")}}),[]),null};function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){defineProperty._defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}ValidatorReset.propTypes={name:PropTypes.string.isRequired};var asyncValidator=function(){var e=asyncToGenerator._asyncToGenerator(asyncToGenerator._regeneratorRuntime.mark((function _callee(e){var t,r,a,n=arguments;return asyncToGenerator._regeneratorRuntime.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(t=n.length>1&&void 0!==n[1]?n[1]:void 0,r=n.length>2?n[2]:void 0,e){o.next=4;break}return o.abrupt("return",void 0);case 4:return o.prev=4,o.next=7,index.findSource(e);case 7:a=o.sent,o.next=14;break;case 10:return o.prev=10,o.t0=o.catch(4),console.error(handleError.handleError(o.t0)),o.abrupt("return",void 0);case 14:if(!a.data.sources.find((function(e){return e.id!==t}))){o.next=16;break}throw r.formatMessage({defaultMessage:"That name is taken. Try another.",id:"wizard.nameTaken"});case 16:return o.abrupt("return",void 0);case 17:case"end":return o.stop()}}),_callee,null,[[4,10]])})));return function asyncValidator(t){return e.apply(this,arguments)}}(),firstValidation=!0,setFirstValidated=function setFirstValidated(e){return firstValidation=e},getFirstValidated=function getFirstValidated(){return firstValidation},asyncValidatorDebounced=debouncePromise(asyncValidator),asyncValidatorDebouncedWrapper=function asyncValidatorDebouncedWrapper(e){return getFirstValidated()?(setFirstValidated(!1),function(t,r){return t?asyncValidator(t,r,e):void 0}):asyncValidatorDebounced},compileAllSourcesComboOptions=function compileAllSourcesComboOptions(e){return toConsumableArray._toConsumableArray(e.sort((function(e,t){return e.product_name.localeCompare(t.product_name)})).map((function(e){return{value:e.name,label:e.product_name}})))},compileAllApplicationComboOptions=function compileAllApplicationComboOptions(e,t){return[{label:t.formatMessage({id:"wizard.none",defaultMessage:"None"}),key:"none"}].concat(toConsumableArray._toConsumableArray(e.sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){return{value:e.id,label:e.display_name}}))))},appMutator=function appMutator(e){return function(t,r){if(!t.value)return t;var a=r.getState().values.source_type,n=e.find((function(e){return e.display_name===t.label})),o=!a||n.supported_source_types.includes(a);return _objectSpread({},t,{isDisabled:!o})}},sourceTypeMutator=function sourceTypeMutator(e,t){return function(r,a){var n=a.getState().values.application?a.getState().values.application.application_type_id:void 0,o=e.find((function(e){return e.id===n})),i=!o||o.supported_source_types.includes(t.find((function(e){return e.product_name===r.label})).name);return _objectSpread({},r,{isDisabled:!i})}},iconMapper=function iconMapper(e){return function(t){var r=e.find((function(e){return e.name===t}));if(!r||!r.icon_url)return null;return function Icon(){return React__default.createElement("img",{src:r.icon_url,alt:r.product_name,className:"ins-c-sources__wizard--icon"})}}},nextStep=function nextStep(e){var t=e.values,r=t.application,a=t.source_type,n=r&&r.application_type_id;return n?"".concat(a,"-").concat(n):a},typesStep=function typesStep(e,t,r,a){return{title:a.formatMessage({id:"wizard.chooseAppAndType",defaultMessage:"Application and source type"}),name:"types_step",nextStep:nextStep,fields:[{component:"enhanced-select",name:"application.application_type_id",label:a.formatMessage({id:"wizard.selectYourApplication",defaultMessage:"A. Select application"}),options:compileAllApplicationComboOptions(t,a),mutator:appMutator(t),description:a.formatMessage({id:"wizard.selectAppWarning",defaultMessage:"Selecting an application will limit the available source types. You can attach an application to this source using the dropdown below, or by clicking ‘Manage applications’ after source creation."}),isDisabled:r,placeholder:a.formatMessage({id:"wizard.chooseApp",defaultMessage:"Choose application"})},{component:"card-select",name:"source_type",isRequired:!0,label:a.formatMessage({id:"wizard.selectYourSourceType",defaultMessage:"B. Select source type"}),iconMapper:iconMapper(e),validate:[{type:validatorTypes.REQUIRED}],options:compileAllSourcesComboOptions(e),mutator:sourceTypeMutator(t,e)},{component:"description",name:"fixasyncvalidation",Content:ValidatorReset}]}},NameDescription=function NameDescription(){var e=reactIntl.useIntl();return(React__default.createElement(TextContent_js.TextContent,{key:"step1"},React__default.createElement(Text_js.Text,{component:Text_js.TextVariants.p},e.formatMessage({id:"wizard.nameDescription",defaultMessage:"To import data for an application, you need to connect to a data source. Enter a name, then proceed to select your application and source type."}))))},nameStep=function nameStep(e){return{title:e.formatMessage({id:"wizard.name",defaultMessage:"Name"}),name:"name_step",nextStep:"types_step",fields:[{component:"description",name:"description-summary",Content:NameDescription},{component:componentTypes.TEXT_FIELD,name:"source.name",type:"text",label:e.formatMessage({id:"wizard.name",defaultMessage:"Name"}),placeholder:"Source_1",isRequired:!0,validate:[function(t){return asyncValidatorDebouncedWrapper(e)(t,void 0,e)},{type:validatorTypes.REQUIRED}],resolveProps:validated.default}]}},SummaryDescription=function SummaryDescription(){var e=reactIntl.useIntl();return(React__default.createElement(TextContent_js.TextContent,null,React__default.createElement(Text_js.Text,{component:Text_js.TextVariants.p},e.formatMessage({id:"wizard.summaryDescription",defaultMessage:"Review the information below and click Add to add your source. Use the Back button to make changes."}))))},summaryStep=function summaryStep(e,t,r){return{fields:[{component:"description",name:"description-summary",Content:SummaryDescription},{name:"summary",component:"summary",sourceTypes:e,applicationTypes:t}],name:"summary",title:r.formatMessage({id:"wizard.reviewDetails",defaultMessage:"Review details"})}},createSchema=function(e,t,r,a,n){return setFirstValidated(!0),{fields:[{component:componentTypes.WIZARD,name:"wizard",title:hardcodedSchemas.WIZARD_TITLE,inModal:!0,description:hardcodedSchemas.WIZARD_DESCRIPTION,buttonLabels:{submit:n.formatMessage({id:"sources.add",defaultMessage:"Add"}),back:n.formatMessage({id:"wizard.back",defaultMessage:"Back"}),cancel:n.formatMessage({id:"wizard.cancel",defaultMessage:"Cancel"}),next:n.formatMessage({id:"wizard.next",defaultMessage:"Next"})},container:a,showTitles:!0,crossroads:["application.application_type_id","source_type","auth_select"],fields:[nameStep(n),typesStep(e,t,r,n)].concat(toConsumableArray._toConsumableArray(schemaBuilder.schemaBuilder(e,t)),[summaryStep(e,t,n)])}]}};exports.NameDescription=NameDescription,exports.SummaryDescription=SummaryDescription,exports.appMutator=appMutator,exports.asyncValidator=asyncValidator,exports.asyncValidatorDebounced=asyncValidatorDebounced,exports.asyncValidatorDebouncedWrapper=asyncValidatorDebouncedWrapper,exports.default=createSchema,exports.getFirstValidated=getFirstValidated,exports.iconMapper=iconMapper,exports.nextStep=nextStep,exports.setFirstValidated=setFirstValidated,exports.sourceTypeMutator=sourceTypeMutator;

"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var objectWithoutProperties=require("./objectWithoutProperties-9e2b4e81.js"),defineProperty=require("./defineProperty-e27f3954.js"),React=require("react"),React__default=_interopDefault(React),reactIntl=require("react-intl"),componentTypes=_interopDefault(require("@data-driven-forms/react-form-renderer/dist/cjs/component-types")),validatorTypes=_interopDefault(require("@data-driven-forms/react-form-renderer/dist/cjs/validator-types")),toConsumableArray=require("./toConsumableArray-45c41c5f.js"),get=_interopDefault(require("lodash/get")),hardcodedSchemas=require("./hardcodedSchemas-c4639129.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){defineProperty._defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var acronymMapper=function acronymMapper(e){return{"Amazon Web Services":"AWS"}[e]||e},hardcodedSchema=function hardcodedSchema(e,t,n){return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n],void 0)},getAdditionalSteps=function getAdditionalSteps(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"additionalSteps"],[])},shouldSkipSelection=function shouldSkipSelection(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"skipSelection"],!1)},shouldSkipEndpoint=function shouldSkipEndpoint(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"skipEndpoint"],!1)},hasCustomSteps=function hasCustomSteps(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"customSteps"],!1)},getAdditionalStepKeys=function getAdditionalStepKeys(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"includeStepKeyFields"],[])},getOnlyHiddenFields=function getOnlyHiddenFields(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"onlyHiddenFields"],!1)},getAdditionalStepFields=function getAdditionalStepFields(e,t){return e.filter((function(e){return e.stepKey===t})).map((function(e){e.stepKey;return objectWithoutProperties._objectWithoutProperties(e,["stepKey"])}))},getNoStepsFields=function getNoStepsFields(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter((function(e){return!e.stepKey||t.includes(e.stepKey)}))},injectAuthFieldsInfo=function injectAuthFieldsInfo(e,t,n,a){return e.map((function(e){var i=get(hardcodedSchemas.hardcodedSchemas,[t,"authentication",n,a]),o=i?get(i,e.name):get(hardcodedSchemas.hardcodedSchemas,[t,"authentication",n,"generic",e.name]),d=o?_objectSpread({},e,{},o):e;return"authentication.password"===d.name&&(d.component="authentication"),d}))},injectEndpointFieldsInfo=function injectEndpointFieldsInfo(e,t){return e.map((function(e){var n=get(hardcodedSchemas.hardcodedSchemas,[t,"endpoint",e.name]);return n?_objectSpread({},e,{},n):e}))},getAdditionalAuthFields=function getAdditionalAuthFields(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic";return get(hardcodedSchemas.hardcodedSchemas,[e,"authentication",t,n,"additionalFields"],[])},getAdditionalEndpointFields=function getAdditionalEndpointFields(e){return get(hardcodedSchemas.hardcodedSchemas,[e,"endpoint","additionalFields"],[])},createEndpointStep=function createEndpointStep(e,t){return _objectSpread({},e,{fields:[].concat(toConsumableArray._toConsumableArray(getAdditionalEndpointFields(t)),toConsumableArray._toConsumableArray(injectEndpointFieldsInfo(e.fields,t))),name:"".concat(t,"-endpoint"),nextStep:"summary"})},createAdditionalSteps=function createAdditionalSteps(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"generic";return e.map((function(e){var d=e.name||"".concat(t,"-").concat(n,"-").concat(o,"-additional-step"),r=shouldSkipEndpoint(t,n,o),c=hasCustomSteps(t,n,o);return _objectSpread({name:d,nextStep:!a||r||c?"summary":"".concat(t,"-endpoint")},e,{fields:[].concat(toConsumableArray._toConsumableArray(injectAuthFieldsInfo(e.fields,t,n,o)),toConsumableArray._toConsumableArray(injectAuthFieldsInfo(getAdditionalStepFields(i,d),t,n,o)))})}))},createGenericAuthTypeSelection=function createGenericAuthTypeSelection(e,t,n){var a=e.schema.authentication,i=a.length>1,o=toConsumableArray._toConsumableArray(t),d={};if(i)return a.forEach((function(a){var i=getAdditionalStepKeys(e.name,a.type),r=shouldSkipEndpoint(e.name,a.type,"generic"),c=getOnlyHiddenFields(e.name,a.type),s=c?a.fields.filter((function(e){return e.hideField})):a.fields;o.push({component:"auth-select",name:"auth_select",label:a.name,authName:a.type,validate:[{type:validatorTypes.REQUIRED}],disableAuthType:n}),o.push({component:componentTypes.SUB_FORM,name:"".concat(a.type,"-subform"),className:"pf-u-pl-md",fields:[].concat(toConsumableArray._toConsumableArray(getAdditionalAuthFields(e.name,a.type)),toConsumableArray._toConsumableArray(injectAuthFieldsInfo(getNoStepsFields(s,i),e.name,a.type))),condition:{when:"auth_select",is:a.type},hideField:c}),d[a.type]=getAdditionalSteps(e.name,a.type).length>0?"".concat(e.name,"-").concat(a.type,"-generic-additional-step"):0!==t.length||r?"summary":"".concat(e.name,"-endpoint")})),{name:e.name,title:React__default.createElement(reactIntl.FormattedMessage,{id:"wizard.configureCredentials",defaultMessage:"Configure {title} credentials",values:{title:acronymMapper(e.product_name)}}),fields:o,nextStep:{when:"auth_select",stepMapper:d}};var r=a[0],c="".concat(e.name,"-").concat(r.type,"-generic-additional-step"),s=shouldSkipEndpoint(e.name,r.type,"generic"),l=getAdditionalSteps(e.name,r.type).length>0?c:0!==t.length||s?"summary":"".concat(e.name,"-endpoint"),p=getAdditionalStepKeys(e.name,r.type),u={};if(shouldSkipSelection(e.name,r.type)){var m=getAdditionalSteps(e.name,r.type).find((function(e){return!e.name})),h=getAdditionalStepFields(r.fields,c);u=_objectSpread({},m,{fields:[].concat(toConsumableArray._toConsumableArray(o),toConsumableArray._toConsumableArray(injectAuthFieldsInfo([].concat(toConsumableArray._toConsumableArray(m.fields),toConsumableArray._toConsumableArray(h)),e.name,r.type)))})}return _objectSpread({name:e.name,title:React__default.createElement(reactIntl.FormattedMessage,{id:"wizard.configureTypeAuthcredentials",defaultMessage:"Configure {title} - {name} credentials",values:{title:acronymMapper(e.product_name),name:r.name}}),fields:[].concat(toConsumableArray._toConsumableArray(o),toConsumableArray._toConsumableArray(getAdditionalAuthFields(e.name,r.type)),toConsumableArray._toConsumableArray(injectAuthFieldsInfo(getNoStepsFields(r.fields,p),e.name,r.type))),nextStep:l},u)},createSpecificAuthTypeSelection=function createSpecificAuthTypeSelection(e,t,n,a){var i=e.schema.authentication,o=t.supported_authentication_types[e.name],d=o.length>1,r=toConsumableArray._toConsumableArray(n),c={};if(d)return i.filter((function(e){var t=e.type;return o.includes(t)})).forEach((function(i){var o,d=hardcodedSchema(e.name,i.type,t.name)?t.name:"generic",s=shouldSkipEndpoint(e.name,i.type,d),l=hasCustomSteps(e.name,i.type,d);o=getAdditionalSteps(e.name,i.type,t.name).length>0?"".concat(e.name,"-").concat(i.type,"-").concat(t.name,"-additional-step"):0!==n.length||s||l?"summary":"".concat(e.name,"-endpoint");var p=getAdditionalStepKeys(e.name,i.type,d),u=getOnlyHiddenFields(e.name,i.type,d),m=u?i.fields.filter((function(e){return e.hideField})):i.fields;r.push({component:"auth-select",name:"auth_select",label:i.name,authName:i.type,validate:[{type:validatorTypes.REQUIRED}],supportedAuthTypes:t.supported_authentication_types[e.name],disableAuthType:a}),r.push({component:componentTypes.SUB_FORM,name:"".concat(i.type,"-subform"),className:"pf-u-pl-md",fields:[].concat(toConsumableArray._toConsumableArray(getAdditionalAuthFields(e.name,i.type,d)),toConsumableArray._toConsumableArray(injectAuthFieldsInfo(getNoStepsFields(m,p),e.name,i.type,d))),condition:{when:"auth_select",is:i.type},hideField:u}),c[i.type]=o})),{name:"".concat(e.name,"-").concat(t.id),title:React__default.createElement(reactIntl.FormattedMessage,{id:"wizard.chooseAuthType",defaultMessage:"Choose authentication type"}),fields:r,nextStep:{when:"auth_select",stepMapper:c}};var s,l=i.find((function(e){var t=e.type;return o.includes(t)})),p=hardcodedSchema(e.name,l.type,t.name)?t.name:"generic",u="".concat(e.name,"-").concat(l.type,"-").concat(t.name,"-additional-step"),m=shouldSkipEndpoint(e.name,l.type,p),h=hasCustomSteps(e.name,l.type,p);s=getAdditionalSteps(e.name,l.type,p).length>0?u:0!==n.length||m?"summary":"".concat(e.name,"-endpoint");var y=getAdditionalStepKeys(e.name,l.type,p),S={};if(shouldSkipSelection(e.name,l.type,p)){var f=getAdditionalSteps(e.name,l.type,p).find((function(e){return!e.name})),A=getAdditionalStepFields(l.fields,u);s=f.nextStep?f.nextStep:0!==n.length||m||h?"summary":"".concat(e.name,"-endpoint"),S=_objectSpread({},f,{fields:[].concat(toConsumableArray._toConsumableArray(r),toConsumableArray._toConsumableArray(injectAuthFieldsInfo([].concat(toConsumableArray._toConsumableArray(f.fields),toConsumableArray._toConsumableArray(A)),e.name,l.type,p)))})}return _objectSpread({name:"".concat(e.name,"-").concat(t.id),title:React__default.createElement(reactIntl.FormattedMessage,{id:"wizard.configureCredentials",defaultMessage:"Configure {title} credentials",title:{title:l.name}}),fields:[].concat(toConsumableArray._toConsumableArray(r),toConsumableArray._toConsumableArray(getAdditionalAuthFields(e.name,l.type,p)),toConsumableArray._toConsumableArray(injectAuthFieldsInfo(getNoStepsFields(l.fields,y),e.name,l.type,p))),nextStep:s},S)},schemaBuilder=function schemaBuilder(e,t,n){var a=[];return e.forEach((function(e){var i=e.schema.endpoint.hidden?e.schema.endpoint.fields:[],o=0===i.length;a.push(createGenericAuthTypeSelection(e,i,n)),t.forEach((function(t){t.supported_source_types.includes(e.name)&&a.push(createSpecificAuthTypeSelection(e,t,i,n))})),e.schema.authentication.forEach((function(n){var i=getAdditionalSteps(e.name,n.type);i.length>0&&a.push.apply(a,toConsumableArray._toConsumableArray(createAdditionalSteps(i,e.name,n.type,o,n.fields))),t.forEach((function(t){var i=getAdditionalSteps(e.name,n.type,t.name);i.length>0&&a.push.apply(a,toConsumableArray._toConsumableArray(createAdditionalSteps(i,e.name,n.type,o,n.fields,t.name)))}))})),o&&a.push(createEndpointStep(e.schema.endpoint,e.name))})),a},schemaBuilder$1=Object.freeze({__proto__:null,acronymMapper:acronymMapper,hardcodedSchema:hardcodedSchema,getAdditionalSteps:getAdditionalSteps,shouldSkipSelection:shouldSkipSelection,shouldSkipEndpoint:shouldSkipEndpoint,hasCustomSteps:hasCustomSteps,getAdditionalStepKeys:getAdditionalStepKeys,getOnlyHiddenFields:getOnlyHiddenFields,getAdditionalStepFields:getAdditionalStepFields,getNoStepsFields:getNoStepsFields,injectAuthFieldsInfo:injectAuthFieldsInfo,injectEndpointFieldsInfo:injectEndpointFieldsInfo,getAdditionalAuthFields:getAdditionalAuthFields,getAdditionalEndpointFields:getAdditionalEndpointFields,createEndpointStep:createEndpointStep,createAdditionalSteps:createAdditionalSteps,createGenericAuthTypeSelection:createGenericAuthTypeSelection,createSpecificAuthTypeSelection:createSpecificAuthTypeSelection,schemaBuilder:schemaBuilder});exports.acronymMapper=acronymMapper,exports.createAdditionalSteps=createAdditionalSteps,exports.createEndpointStep=createEndpointStep,exports.createGenericAuthTypeSelection=createGenericAuthTypeSelection,exports.createSpecificAuthTypeSelection=createSpecificAuthTypeSelection,exports.getAdditionalAuthFields=getAdditionalAuthFields,exports.getAdditionalEndpointFields=getAdditionalEndpointFields,exports.getAdditionalStepFields=getAdditionalStepFields,exports.getAdditionalStepKeys=getAdditionalStepKeys,exports.getAdditionalSteps=getAdditionalSteps,exports.getNoStepsFields=getNoStepsFields,exports.getOnlyHiddenFields=getOnlyHiddenFields,exports.hardcodedSchema=hardcodedSchema,exports.hasCustomSteps=hasCustomSteps,exports.injectAuthFieldsInfo=injectAuthFieldsInfo,exports.injectEndpointFieldsInfo=injectEndpointFieldsInfo,exports.schemaBuilder=schemaBuilder,exports.schemaBuilder$1=schemaBuilder$1,exports.shouldSkipEndpoint=shouldSkipEndpoint,exports.shouldSkipSelection=shouldSkipSelection;

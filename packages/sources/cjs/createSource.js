"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./_commonjsHelpers-32c5d30b.js"),require("./objectWithoutProperties-9e2b4e81.js");var slicedToArray=require("./slicedToArray-359307e9.js"),defineProperty=require("./defineProperty-cf06dcaa.js");require("lodash/get"),require("@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors"),require("./constants.js");var index=require("./index-1dfedd03.js"),asyncToGenerator=require("./asyncToGenerator-a32dc547.js"),handleError=require("./handleError.js"),costManagementAuthentication=require("./costManagementAuthentication.js"),getApplicationStatus=require("./getApplicationStatus.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){defineProperty._defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var parseUrl=function parseUrl(e){if(!e)return{};try{var r=new URL(e);return{scheme:r.protocol.replace(/:$/,""),host:r.hostname,port:r.port,path:r.pathname}}catch(e){return console.log(e),{}}},urlOrHost=function urlOrHost(e){return e.url?parseUrl(e.url):e},handleErrorWrapper=function handleErrorWrapper(e){return function(){var r=asyncToGenerator._asyncToGenerator(asyncToGenerator._regeneratorRuntime.mark((function _callee(r){return asyncToGenerator._regeneratorRuntime.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,handleError.handleError(r,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),_callee)})));return function(e){return r.apply(this,arguments)}}()},doCreateSource=function(){var e=asyncToGenerator._asyncToGenerator(asyncToGenerator._regeneratorRuntime.mark((function _callee2(e,r){var t,n,o,a,i,c,s,p,u,l,d,h,y,_,f,v,b,j,g,m,S,x,O,A,P,w,E=arguments;return asyncToGenerator._regeneratorRuntime.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return t=E.length>2&&void 0!==E[2]?E[2]:[],T.prev=1,a=r.find((function(r){return r.name===e.source_type})).id,T.next=5,index.getSourcesApi().createSource(_objectSpread({},e.source,{source_type_id:a}));case 5:return n=T.sent,i=[],e.endpoint?(c=urlOrHost(e),s=c.scheme,p=c.host,u=c.port,l=c.path,d=parseInt(u,10),h=_objectSpread({},e.endpoint,{default:!0,source_id:n.id,scheme:s,host:p,port:isNaN(d)?void 0:d,path:l}),i.push(index.getSourcesApi().createEndpoint(h))):i.push(Promise.resolve(void 0)),e.application&&e.application.application_type_id?(y=_objectSpread({},e.application,{source_id:n.id}),i.push(index.getSourcesApi().createApplication(y))):i.push(Promise.resolve(void 0)),T.next=11,Promise.all(i);case 11:if(_=T.sent,f=slicedToArray._slicedToArray(_,2),v=f[0],b=f[1],!(v||e.authentication&&(null===(o=b)||void 0===o?void 0:o.id))){T.next=20;break}return m=_objectSpread({},e.authentication,{resource_id:(null==v?void 0:v.id)||(null===(g=b)||void 0===g?void 0:g.id),resource_type:(null==v?void 0:v.id)?"Endpoint":"Application"}),T.next=19,index.getSourcesApi().createAuthentication(m);case 19:j=T.sent;case 20:return S=[],e.credentials||e.billing_source?(x=e.credentials,O=e.billing_source,A={},A=x?{authentication:{credentials:x}}:{},A=O?_objectSpread({},A,{billing_source:O}):A,S.push(costManagementAuthentication.patchSource(_objectSpread({id:n.id},A)))):i.push(Promise.resolve(void 0)),j&&b?(P={application_id:b.id,authentication_id:j.id},S.push(index.getSourcesApi().createAuthApp(P))):i.push(Promise.resolve(void 0)),T.next=25,Promise.all(S);case 25:if(!b){T.next=30;break}return w=t.includes(b.application_type_id)?1e4:0,T.next=29,getApplicationStatus.checkAppAvailability(b.id,w);case 29:b=T.sent;case 30:return T.abrupt("return",_objectSpread({},n,{endpoint:[v],applications:[b]}));case 33:return T.prev=33,T.t0=T.catch(1),T.next=37,handleError.handleError(T.t0,n?n.id:void 0);case 37:throw T.sent;case 39:case"end":return T.stop()}}),_callee2,null,[[1,33]])})));return function doCreateSource(r,t){return e.apply(this,arguments)}}();exports.doCreateSource=doCreateSource,exports.handleErrorWrapper=handleErrorWrapper,exports.parseUrl=parseUrl,exports.urlOrHost=urlOrHost;

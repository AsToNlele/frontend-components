import"./_commonjsHelpers-e2cda605.js";import{S as e,_ as t}from"./index-637b7b85.js";import{_ as r}from"./objectWithoutProperties-be1375b5.js";import{_ as o}from"./slicedToArray-1bde1c63.js";import{_ as s}from"./defineProperty-0a7db1e6.js";import i,{useReducer as n,useRef as a,useEffect as c,useState as p}from"react";import{Button as u}from"@patternfly/react-core/dist/esm/components/Button/Button.js";import d from"prop-types";import l from"lodash/isEmpty";import{useIntl as m,FormattedMessage as f}from"react-intl";import{Wizard as y}from"@patternfly/react-core/dist/esm/components/Wizard/Wizard.js";import"@data-driven-forms/react-form-renderer/dist/cjs/form-renderer";import"@data-driven-forms/react-form-renderer/dist/cjs/component-types";import"@data-driven-forms/react-form-renderer/dist/cjs/validator-types";import"@data-driven-forms/react-form-renderer/dist/cjs/validator-mapper";import"@data-driven-forms/pf4-component-mapper/dist/cjs/form-template";import"@data-driven-forms/pf4-component-mapper/dist/cjs/component-mapper";import"./toConsumableArray-6a92248c.js";import"@patternfly/react-core/dist/esm/components/Text/TextContent.js";import"@patternfly/react-core/dist/esm/components/Text/TextListItem.js";import"@patternfly/react-core/dist/esm/components/Text/TextList.js";import"@patternfly/react-core/dist/esm/components/Alert/Alert.js";import"lodash/get";import"@patternfly/react-core/dist/esm/components/Form/FormHelperText.js";import"@patternfly/react-icons/dist/esm/icons/question-circle-icon";import"@patternfly/react-core/dist/esm/components/Popover/Popover.js";import{Text as S}from"@patternfly/react-core/dist/esm/components/Text/Text.js";import{W as g,a as j}from"./hardcodedSchemas-1df4e8df.js";import"@patternfly/react-core/dist/esm/components/ClipboardCopy/ClipboardCopy.js";import"@data-driven-forms/react-form-renderer/dist/cjs/use-form-api";import"@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors";import{timeoutedApps as b}from"./constants.js";import{d as v,b as h,g as E}from"./index-713c67d9.js";import"./schemaBuilder-f76a5124.js";import"./SourceWizardSummary.js";import"@patternfly/react-core/dist/esm/components/Card/Card.js";import"@patternfly/react-core/dist/esm/components/Card/CardBody.js";import"@patternfly/react-core/dist/esm/components/Form/FormGroup.js";import"@patternfly/react-core/dist/esm/layouts/Grid/Grid.js";import"@patternfly/react-core/dist/esm/layouts/Grid/GridItem.js";import"@patternfly/react-core/dist/esm/layouts/Bullseye/Bullseye.js";import"@patternfly/react-core/dist/esm/components/Card/CardTitle.js";import"@data-driven-forms/react-form-renderer/dist/cjs/use-field-api";import"./CardSelect.js";import"@patternfly/react-core/dist/esm/components/Radio/Radio.js";import"./AuthSelect.js";import"@data-driven-forms/pf4-component-mapper/dist/cjs/select";import"./asyncToGenerator-feb014e2.js";import"awesome-debounce-promise";import T from"./SourceAddSchema.js";import"./handleError.js";import"@patternfly/react-core/dist/esm/components/Spinner/Spinner.js";import"@data-driven-forms/react-form-renderer/dist/cjs/form-spy";import"./validated.js";import"@patternfly/react-core/dist/esm/components/EmptyState/EmptyState.js";import"@patternfly/react-core/dist/esm/components/EmptyState/EmptyStateSecondaryActions.js";import"@patternfly/react-core/dist/esm/components/EmptyState/EmptyStateIcon.js";import"@patternfly/react-core/dist/esm/components/Title/Title.js";import C from"./LoadingStep.js";import M from"./filterApps.js";import w from"./filterTypes.js";import{Link as O}from"react-router-dom";import"@patternfly/react-core/dist/esm/components/EmptyState/EmptyStateBody.js";import"@patternfly/react-icons/dist/esm/icons/check-circle-icon";import A from"./FinishedStep.js";import"@patternfly/react-icons/dist/esm/icons/exclamation-circle-icon";import B from"./ErroredStep.js";import"@patternfly/react-icons/dist/esm/icons/wrench-icon";import R from"./TimeoutStep.js";import"./costManagementAuthentication.js";import"./getApplicationStatus.js";import{doCreateSource as P}from"./createSource.js";import"@patternfly/react-core/dist/esm/components/Modal/Modal.js";import"@patternfly/react-icons/dist/esm/icons/exclamation-triangle-icon";import q from"./CloseModal.js";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}var x={schema:{},sourceTypes:[],isLoading:!0},z=function reducer(e,t){var r=t.type,o=t.sourceTypes,i=t.applicationTypes,n=t.container,a=t.disableAppSelection,c=t.intl;switch(r){case"loaded":return function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{schema:T(o.filter(w),i.filter(M),a,n,c),isLoading:!1,sourceTypes:o})}},k=function SourceAddModal(t){var r=t.sourceTypes,s=t.applicationTypes,p=t.disableAppSelection,u=t.isCancelling,d=t.onCancel,l=t.values,f=t.onSubmit,S=n(z,x),b=o(S,2),E=b[0],T=E.schema,M=E.sourceTypes,w=E.isLoading,O=b[1],A=a(!1),B=a(document.createElement("div")),R=m();return c((function(){A.current=!0;var e=[];return r||e.push(v()),s||e.push(h()),Promise.all(e).then((function(e){var t=e.find((function(e){return e.hasOwnProperty("sourceTypes")})),o=e.find((function(e){return e.hasOwnProperty("applicationTypes")}));A.current&&O({type:"loaded",sourceTypes:r||t.sourceTypes,applicationTypes:s||o.applicationTypes,disableAppSelection:p,container:B.current,intl:R})})),function(){A.current=!1}}),[]),c((function(){B.current.hidden=u}),[u]),w?i.createElement(y,{isOpen:!0,onClose:d,title:g,description:j,steps:[{name:"Loading",component:i.createElement(C,{onClose:function onClose(){return d()}}),isFinishedStep:!0}]}):i.createElement(e,{initialValues:l,schema:T,onSubmit:function onSubmit(e){return f(e,M)},onCancel:d})};k.propTypes={onCancel:d.func.isRequired,onSubmit:d.func.isRequired,sourceTypes:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,product_name:d.string.isRequired,schema:d.shape({authentication:d.array,endpoint:d.object})})),applicationTypes:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,display_name:d.string.isRequired})),values:d.object,disableAppSelection:d.bool,isCancelling:d.bool},k.defaultProps={values:{},disableAppSelection:!1};var _=function FinalWizard(e){var t,r=e.afterSubmit,s=e.afterError,n=e.isFinished,a=e.isErrored,c=e.successfulMessage,d=e.hideSourcesButton,l=e.returnButtonTitle,f=e.reset,b=e.createdSource,v=void 0===b?{}:b,h=e.tryAgain,T=e.afterSuccess,M=p(),w=o(M,2),P=w[0],q=w[1],x=p(),z=o(x,2),k=z[0],_=z[1],F=m();if(k)t=i.createElement(A,{onClose:r,title:F.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:F.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:d,returnButtonTitle:l,secondaryActions:i.createElement(u,{variant:"link",onClick:f},F.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))});else if(P)t=i.createElement(C,{customText:F.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(n){var D,V;if("available"===(null===(D=v.applications[0])||void 0===D?void 0:D.availability_status))t=i.createElement(A,{onClose:r,successfulMessage:c,hideSourcesButton:d,returnButtonTitle:l,secondaryActions:i.createElement(u,{variant:"link",onClick:f},F.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))});else if("unavailable"===(null===(V=v.applications[0])||void 0===V?void 0:V.availability_status)){var $;t=i.createElement(B,{onClose:r,secondaryActions:i.createElement(u,{variant:"link",onClick:function removeSource(){return q(!0),E().removeSource(v.id).then((function(){T&&T(),_(!0)})).catch((function(){return q(!1)}))}},F.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function Component(){return i.createElement(O,{to:"/sources/edit/".concat(v.id)},i.createElement(u,{variant:"primary",className:"pf-u-mt-xl"},F.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))},message:(null===($=v.applications[0])||void 0===$?void 0:$.availability_status_error)||F.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:F.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})})}else t=v.applications[0]?i.createElement(R,{onClose:r,returnButtonTitle:l,secondaryActions:i.createElement(u,{variant:"link",onClick:f},F.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))}):i.createElement(A,{onClose:r,successfulMessage:c,hideSourcesButton:d,returnButtonTitle:l,secondaryActions:i.createElement(u,{variant:"link",onClick:f},F.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}))})}else t=a?i.createElement(B,{onClose:s,primaryAction:h,secondaryActions:i.createElement(S,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},F.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:F.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):i.createElement(C,{customText:F.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating source credentials"}),onClose:s,cancelTitle:F.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return(i.createElement(y,{isOpen:!0,onClose:n?r:s,title:g,description:j,steps:[{name:"Finish",component:t,isFinishedStep:!0}]}))};function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}_.propTypes={afterSubmit:d.func.isRequired,afterError:d.func.isRequired,isFinished:d.bool.isRequired,isErrored:d.bool.isRequired,successfulMessage:d.node.isRequired,hideSourcesButton:d.bool,returnButtonTitle:d.node.isRequired,errorMessage:d.node,reset:d.func,createdSource:d.object,tryAgain:d.func,afterSuccess:d.func};var F=function prepareInitialValues(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},D=function reducer(e,t){var r=t.type,o=t.values,s=t.data,i=t.error,n=t.initialValues,a=t.sourceTypes;switch(r){case"reset":return F(n);case"prepareSubmitState":return _objectSpread$1({},e,{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:o,sourceTypes:a});case"setSubmitted":return _objectSpread$1({},e,{isFinished:!0,createdSource:s});case"setErrored":return _objectSpread$1({},e,{isErrored:!0,error:i.toString()});case"onStay":return _objectSpread$1({},e,{isCancelling:!1});case"showCancelModal":return _objectSpread$1({},e,{isCancelling:!0,values:o})}},V=function AddSourceWizard(e){var t=e.successfulMessage,s=e.isOpen,a=e.sourceTypes,c=e.applicationTypes,p=e.disableAppSelection,u=e.hideSourcesButton,d=e.returnButtonTitle,m=e.initialValues,f=e.onClose,y=e.afterSuccess,S=n(D,F(m)),g=o(S,2),j=g[0],v=j.isErrored,h=j.isFinished,E=j.isSubmitted,T=j.values,C=j.error,M=j.isCancelling,w=j.createdSource,O=r(j,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),A=g[1],B=function onSubmit(e,t){return A({type:"prepareSubmitState",values:e,sourceTypes:t}),P(e,t,b(c)).then((function(e){y&&y(e),A({type:"setSubmitted",data:e})})).catch((function(e){A({type:"setErrored",error:e})}))};return s?E?i.createElement(_,{afterSubmit:function afterSubmit(){f(void 0,w),A({type:"reset",initialValues:m})},afterError:function afterError(){return f({})},isFinished:h,isErrored:v,successfulMessage:t,hideSourcesButton:u,returnButtonTitle:d,errorMessage:C,reset:function reset(){return A({type:"reset",initialValues:m})},createdSource:w,tryAgain:function tryAgain(){return B(T,O.sourceTypes)},afterSuccess:y}):i.createElement(i.Fragment,null,i.createElement(q,{isOpen:M,onExit:function onExit(){return f(T)},onStay:function onStay(){return A({type:"onStay"})}}),i.createElement(k,{isCancelling:M,values:T,onSubmit:B,onCancel:function onCancelBeforeExit(e){return l(e)?f({}):A({type:"showCancelModal",values:e})},sourceTypes:a,applicationTypes:c,disableAppSelection:p})):null};V.propTypes={afterSuccess:d.func,sourceTypes:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,product_name:d.string.isRequired,schema:d.shape({authentication:d.array,endpoint:d.object})})),applicationTypes:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,display_name:d.string.isRequired})),onClose:d.func.isRequired,isOpen:d.bool.isRequired,successfulMessage:d.node,initialValues:d.shape(s({},d.string,d.oneOf([d.string,d.array,d.number,d.bool]))),disableAppSelection:d.bool,hideSourcesButton:d.bool,returnButtonTitle:d.node},V.defaultProps={successfulMessage:i.createElement(f,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:i.createElement(f,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};var $=function AddSourceButton(e){var r=p(!1),s=o(r,2),n=s[0],a=s[1];return(i.createElement(i.Fragment,null,i.createElement(u,{variant:"primary",onClick:function onClick(){return a(!0)}},g),i.createElement(V,t({isOpen:n,onClose:function onClose(){return a(!1)}},e))))};export{$ as AddSourceButton,V as AddSourceWizard};

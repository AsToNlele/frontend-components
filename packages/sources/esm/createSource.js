import"./_commonjsHelpers-e2cda605.js";import"./objectWithoutProperties-be1375b5.js";import{_ as e}from"./slicedToArray-1bde1c63.js";import{_ as t}from"./defineProperty-0a7db1e6.js";import"lodash/get";import"@redhat-cloud-services/frontend-components-utilities/files/cjs/interceptors";import"./constants.js";import{g as r}from"./index-713c67d9.js";import{_ as n,a as o}from"./asyncToGenerator-feb014e2.js";import{handleError as i}from"./handleError.js";import{patchSource as c}from"./costManagementAuthentication.js";import{checkAppAvailability as a}from"./getApplicationStatus.js";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function parseUrl(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}},p=function urlOrHost(e){return e.url?s(e.url):e},u=function handleErrorWrapper(e){return function(){var t=n(o.mark((function _callee(t){return o.wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i(t,e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee)})));return function(e){return t.apply(this,arguments)}}()},l=function(){var t=n(o.mark((function _callee2(t,n){var s,u,l,d,h,f,m,b,_,j,v,y,O,g,P,w,x,S,A,E,k,D,K,$,H,N,T=arguments;return o.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return s=T.length>2&&void 0!==T[2]?T[2]:[],o.prev=1,d=n.find((function(e){return e.name===t.source_type})).id,o.next=5,r().createSource(_objectSpread({},t.source,{source_type_id:d}));case 5:return u=o.sent,h=[],t.endpoint?(f=p(t),m=f.scheme,b=f.host,_=f.port,j=f.path,v=parseInt(_,10),y=_objectSpread({},t.endpoint,{default:!0,source_id:u.id,scheme:m,host:b,port:isNaN(v)?void 0:v,path:j}),h.push(r().createEndpoint(y))):h.push(Promise.resolve(void 0)),t.application&&t.application.application_type_id?(O=_objectSpread({},t.application,{source_id:u.id}),h.push(r().createApplication(O))):h.push(Promise.resolve(void 0)),o.next=11,Promise.all(h);case 11:if(g=o.sent,P=e(g,2),w=P[0],x=P[1],!(w||t.authentication&&(null===(l=x)||void 0===l?void 0:l.id))){o.next=20;break}return E=_objectSpread({},t.authentication,{resource_id:(null==w?void 0:w.id)||(null===(A=x)||void 0===A?void 0:A.id),resource_type:(null==w?void 0:w.id)?"Endpoint":"Application"}),o.next=19,r().createAuthentication(E);case 19:S=o.sent;case 20:return k=[],t.credentials||t.billing_source?(D=t.credentials,K=t.billing_source,$={},$=D?{authentication:{credentials:D}}:{},$=K?_objectSpread({},$,{billing_source:K}):$,k.push(c(_objectSpread({id:u.id},$)))):h.push(Promise.resolve(void 0)),S&&x?(H={application_id:x.id,authentication_id:S.id},k.push(r().createAuthApp(H))):h.push(Promise.resolve(void 0)),o.next=25,Promise.all(k);case 25:if(!x){o.next=30;break}return N=s.includes(x.application_type_id)?1e4:0,o.next=29,a(x.id,N);case 29:x=o.sent;case 30:return o.abrupt("return",_objectSpread({},u,{endpoint:[w],applications:[x]}));case 33:return o.prev=33,o.t0=o.catch(1),o.next=37,i(o.t0,u?u.id:void 0);case 37:throw o.sent;case 39:case"end":return o.stop()}}),_callee2,null,[[1,33]])})));return function doCreateSource(e,r){return t.apply(this,arguments)}}();export{l as doCreateSource,u as handleErrorWrapper,s as parseUrl,p as urlOrHost};
